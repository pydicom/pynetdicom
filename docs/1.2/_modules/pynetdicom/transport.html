

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pynetdicom.transport &mdash; pynetdicom 1.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/pynetdicom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pynetdicom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pynetdicom
          

          
            
            <img src="../../_static/pydicom_flat_black.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../verification_service_class.html">Verification Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../storage_service_class.html">Storage Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../query_retrieve_service_class.html">Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic_worklist_service_class.html">Basic Worklist Management Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relevant_patient_service_class.html">Relevant Patient Information Query Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../substance_admin_service_class.html">Substance Administration Query Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non_patient_service_class.html">Non-Patient Object Storage Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../color_palette_service_class.html">Color Palette Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../defined_procedure_service_class.html">Defined Procedure Protocol Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hanging_protocol_service_class.html">Hanging Protocol Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../implant_template_service_class.html">Implant Template Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../display_system_service_class.html">Display System Management Service Class</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">1.2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html#v1-1-0">1.1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html#v1-0-0">1.0.0</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pynetdicom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pynetdicom.transport</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pynetdicom.transport</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Implementation of the Transport Service.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">SocketServer</span> <span class="k">import</span> <span class="n">TCPServer</span><span class="p">,</span> <span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">BaseRequestHandler</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">socketserver</span> <span class="k">import</span> <span class="n">TCPServer</span><span class="p">,</span> <span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">BaseRequestHandler</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="k">import</span> <span class="n">pack</span>

<span class="kn">from</span> <span class="nn">pynetdicom._globals</span> <span class="k">import</span> <span class="n">MODE_ACCEPTOR</span>


<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pynetdicom.transport&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="AssociationSocket"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationSocket.html#pynetdicom.transport.AssociationSocket">[docs]</a><span class="k">class</span> <span class="nc">AssociationSocket</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A wrapper for the socket.socket object.</span>

<span class="sd">    Provides an interface for socket.socket that is integrated nicely with a</span>
<span class="sd">    pynetdicom Association instance and the state machine.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    select_timeout : float or None</span>
<span class="sd">        The timeout (in seconds) that select.select() calls in ``ready`` will</span>
<span class="sd">        block for (default 0.5). A value of 0 specifies a poll and never</span>
<span class="sd">        blocks. A value of None blocks until a connection is ready.</span>
<span class="sd">    socket : socket.socket or None</span>
<span class="sd">        The wrapped socket, will be None if AssociationSocket.close() is</span>
<span class="sd">        called.</span>
<span class="sd">    tls_args : 2-tuple or None</span>
<span class="sd">        If the socket should be wrapped by TLS then this is</span>
<span class="sd">        (context, hostname), where `context` is a ssl.SSLContext that will be</span>
<span class="sd">        used to wrap the socket and `hostname` is the value to use for</span>
<span class="sd">        the `server_hostname` keyword argument for ``SSLContext.wrap_socket()``</span>
<span class="sd">        If TLS is not to be used then None (default).</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AssociationSocket.__init__"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationSocket.html#pynetdicom.transport.AssociationSocket.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">client_socket</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Create a new AssociationSocket.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        assoc : association.Association</span>
<span class="sd">            The Association instance that will be using the socket to</span>
<span class="sd">            communicate.</span>
<span class="sd">        client_socket : socket.socket, optional</span>
<span class="sd">            The socket to wrap, if not supplied then a new socket will be</span>
<span class="sd">            created instead.</span>
<span class="sd">        address : 2-tuple</span>
<span class="sd">            If `client_socket` is None then this is the (host, port) to bind</span>
<span class="sd">            the newly created socket to, which by default will be (&#39;&#39;, 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assoc</span> <span class="o">=</span> <span class="n">assoc</span>

        <span class="k">if</span> <span class="n">client_socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">address</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;AssociationSocket instantiated with both a &#39;client_socket&#39; &quot;</span>
                <span class="s2">&quot;and bind &#39;address&#39;. The original socket will not be rebound&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">client_socket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_socket</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">client_socket</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Evt5: Transport connection indication</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;Evt5&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tls_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_timeout</span> <span class="o">=</span> <span class="mf">0.5</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">assoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the socket&#39;s parent Association instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assoc</span>

<div class="viewcode-block" id="AssociationSocket.close"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationSocket.html#pynetdicom.transport.AssociationSocket.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the connection to the peer and shutdown the socket.</span>

<span class="sd">        Sets ``AssociationSocket.socket`` to ``None`` once complete.</span>

<span class="sd">        *Events Emitted*</span>

<span class="sd">        - Evt17: Transport connection closed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Evt17: Transport connection closed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;Evt17&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AssociationSocket.connect"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationSocket.html#pynetdicom.transport.AssociationSocket.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try and connect to a remote.</span>

<span class="sd">        **Events Emitted**</span>

<span class="sd">        - Evt2: Transport connection confirmed</span>
<span class="sd">        - Evt17: Transport connection closed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        address : 2-tuple</span>
<span class="sd">            The (host, port) IPv4 address to connect to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_socket</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tls_args</span><span class="p">:</span>
                <span class="n">context</span><span class="p">,</span> <span class="n">server_hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tls_args</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">,</span>
                    <span class="n">server_side</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">server_hostname</span><span class="o">=</span><span class="n">server_hostname</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># Try and connect to remote at (address, port)</span>
            <span class="c1">#   raises socket.error if connection refused</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Evt2: Transport connection confirmation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;Evt2&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># Log connection failure</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Association request failed: unable to connect to remote&quot;</span>
            <span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TCP Initialisation Error: Connection refused&quot;</span><span class="p">)</span>
            <span class="c1"># Log exception if TLS issue to help with troubleshooting</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">):</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="c1"># Don&#39;t be tempted to replace this with a self.close() call -</span>
            <span class="c1">#   it doesn&#39;t work because `_is_connected` is False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;Evt17&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_create_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Create a new IPv4 TCP socket and set it up for use.</span>

<span class="sd">        *Socket Options*</span>

<span class="sd">        - SO_REUSEADDR is 1</span>
<span class="sd">        - SO_RCVTIMEO is set to the Association&#39;s network_timeout value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        address : 2-tuple</span>
<span class="sd">            The (host, port) to bind the socket to. By default the socket</span>
<span class="sd">            is bound to (&#39;&#39;, 0), i.e. the first available port.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        socket.socket</span>
<span class="sd">            An unbound and unconnected socket instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># AF_INET: IPv4, SOCK_STREAM: TCP socket</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="c1"># SO_REUSEADDR: reuse the socket in TIME_WAIT state without</span>
        <span class="c1">#   waiting for its natural timeout to expire</span>
        <span class="c1">#   Allows local address reuse</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># If no timeout is set then recv() will block forever if</span>
        <span class="c1">#   the connection is kept alive with no data sent</span>
        <span class="c1"># SO_RCVTIMEO: the timeout on receive calls in seconds</span>
        <span class="c1">#   set using a packed binary string containing two uint32s as</span>
        <span class="c1">#   (seconds, microseconds)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assoc</span><span class="o">.</span><span class="n">network_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assoc</span><span class="o">.</span><span class="n">network_timeout</span><span class="p">)</span>
            <span class="n">timeout_microsec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assoc</span><span class="o">.</span><span class="n">network_timeout</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">SO_RCVTIMEO</span><span class="p">,</span>
                <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;ll&#39;</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">,</span> <span class="n">timeout_microsec</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">sock</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">event_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Association&#39;s event queue.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assoc</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">event_queue</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if there is data available to be read.</span>

<span class="sd">        *Events Emitted*</span>

<span class="sd">        - None</span>
<span class="sd">        - Evt17: Transport connection closed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the socket has data ready to be read, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use a timeout of 0 so we get an &quot;instant&quot; result</span>
            <span class="n">ready</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Evt17: Transport connection closed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;Evt17&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ready</span><span class="p">)</span>

<div class="viewcode-block" id="AssociationSocket.recv"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationSocket.html#pynetdicom.transport.AssociationSocket.recv">[docs]</a>    <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nr_bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read `nr_bytes` from the socket.</span>

<span class="sd">        *Events Emitted*</span>

<span class="sd">        - None</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nr_bytes : int</span>
<span class="sd">            The number of bytes to attempt to read from the socket.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bytearray</span>
<span class="sd">            The data read from the socket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="n">nr_read</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># socket.recv() returns when the network buffer has been emptied</span>
        <span class="c1">#   not necessarily when the number of bytes requested have been</span>
        <span class="c1">#   read. Its up to us to keep calling recv() until we have all the</span>
        <span class="c1">#   data we want</span>
        <span class="c1"># **BLOCKING** until either all the data is read or an error occurs</span>
        <span class="k">while</span> <span class="n">nr_read</span> <span class="o">&lt;</span> <span class="n">nr_bytes</span><span class="p">:</span>
            <span class="c1"># Python docs recommend reading a relatively small power of 2</span>
            <span class="c1">#   such as 4096</span>
            <span class="n">bufsize</span> <span class="o">=</span> <span class="mi">4096</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nr_bytes</span> <span class="o">-</span> <span class="n">nr_read</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">bufsize</span><span class="p">:</span>
                <span class="n">bufsize</span> <span class="o">=</span> <span class="n">nr_bytes</span> <span class="o">-</span> <span class="n">nr_read</span>

            <span class="n">bytes_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">bufsize</span><span class="p">)</span>

            <span class="c1"># If socket.recv() reads 0 bytes then the connection has been</span>
            <span class="c1">#   broken, so return what we have so far</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bytes_read</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">bytestream</span>

            <span class="n">bytestream</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bytes_read</span><span class="p">)</span>
            <span class="n">nr_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytes_read</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bytestream</span></div>

<div class="viewcode-block" id="AssociationSocket.send"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationSocket.html#pynetdicom.transport.AssociationSocket.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bytestream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try and send `bystream` to the remote.</span>

<span class="sd">        *Events Emitted*</span>

<span class="sd">        - None</span>
<span class="sd">        - Evt17: Transport connected closed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bytestream : bytes</span>
<span class="sd">            The data to send to the remote.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_sent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">total_sent</span> <span class="o">&lt;</span> <span class="n">length_data</span><span class="p">:</span>
                <span class="c1"># Returns the number of bytes sent</span>
                <span class="n">nr_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">bytestream</span><span class="p">[</span><span class="n">total_sent</span><span class="p">:])</span>
                <span class="n">total_sent</span> <span class="o">+=</span> <span class="n">nr_sent</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">):</span>
            <span class="c1"># Evt17: Transport connection closed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;Evt17&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the string output for `socket`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></div>


<span class="k">class</span> <span class="nc">RequestHandler</span><span class="p">(</span><span class="n">BaseRequestHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connection request handler for the AssociationServer.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    request : socket.socket</span>
<span class="sd">        The (unaccepted) client socket.</span>
<span class="sd">    client_address : 2-tuple</span>
<span class="sd">        The (host, port) of the remote.</span>
<span class="sd">    server : transport.AssociationServer or transport.ThreadedAssociationServer</span>
<span class="sd">        The server that received the connection request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ae</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the server&#39;s parent AE.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">ae</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle an association request.</span>

<span class="sd">        * Creates a new Association acceptor instance and configures it.</span>
<span class="sd">        * Sets the Association&#39;s socket to the request&#39;s socket.</span>
<span class="sd">        * Starts the Association reactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pynetdicom.association</span> <span class="k">import</span> <span class="n">Association</span>

        <span class="n">assoc</span> <span class="o">=</span> <span class="n">Association</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="p">,</span> <span class="n">MODE_ACCEPTOR</span><span class="p">)</span>

        <span class="c1"># Set the thread name</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;AcceptorThread@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>

        <span class="n">sock</span> <span class="o">=</span> <span class="n">AssociationSocket</span><span class="p">(</span><span class="n">assoc</span><span class="p">,</span> <span class="n">client_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">set_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>

        <span class="c1"># Association Acceptor object -&gt; local AE</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">maximum_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">maximum_pdu_size</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">ae_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">ae_title</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">implementation_class_uid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">implementation_class_uid</span>
        <span class="p">)</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">implementation_version_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">implementation_version_name</span>
        <span class="p">)</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">supported_contexts</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">supported_contexts</span>
        <span class="p">)</span>

        <span class="c1"># Association Requestor object -&gt; remote AE</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">requestor</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">assoc</span><span class="o">.</span><span class="n">requestor</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">assoc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a 2-tuple of the local server&#39;s (host, port) address.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_address</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a 2-tuple of the remote client&#39;s (host, port) address.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span>


<div class="viewcode-block" id="AssociationServer"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer">[docs]</a><span class="k">class</span> <span class="nc">AssociationServer</span><span class="p">(</span><span class="n">TCPServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Association server implementation.</span>

<span class="sd">    Any attempts to connect will be assumed to be from association requestors.</span>

<span class="sd">    The server should be started with ``serve_forever(poll_interval)``, where</span>
<span class="sd">    ``poll_interval`` is the timeout (in seconds) that the ``select.select()``</span>
<span class="sd">    call will block for (default 0.5). A value of 0 specifies a poll and never</span>
<span class="sd">    blocks. A value of None blocks until a connection is ready.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ae : ae.ApplicationEntity</span>
<span class="sd">        The parent AE that is running the server.</span>
<span class="sd">    server_address : 2-tuple</span>
<span class="sd">        The (host, port) that the server is running on.</span>
<span class="sd">    ssl_context : ssl.SSLContext or None</span>
<span class="sd">        The SSLContext used to wrap client sockets, or None if no TLS is</span>
<span class="sd">        required.</span>
<span class="sd">    request_queue_size : int</span>
<span class="sd">        Default 5.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AssociationServer.__init__"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ae</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">ssl_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new AssociationServer, bind a socket and start listening.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ae : ae.ApplicationEntity</span>
<span class="sd">            The parent AE that&#39;s running the server.</span>
<span class="sd">        address : 2-tuple</span>
<span class="sd">            The (host, port) that the server should run on.</span>
<span class="sd">        ssl_context : ssl.SSLContext, optional</span>
<span class="sd">            If TLS is to be used then this should be the ssl.SSLContext used</span>
<span class="sd">            to wrap the client sockets, otherwise if None then no TLS will be</span>
<span class="sd">            used (default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ae</span> <span class="o">=</span> <span class="n">ae</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl_context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_reuse_address</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">TCPServer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">RequestHandler</span><span class="p">,</span> <span class="n">bind_and_activate</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">60</span></div>

<div class="viewcode-block" id="AssociationServer.server_bind"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer.server_bind">[docs]</a>    <span class="k">def</span> <span class="nf">server_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bind the socket and set the socket options.</span>

<span class="sd">        - socket.SO_REUSEADDR is set to 1</span>
<span class="sd">        - socket.SO_RCVTIMEO is set to AE.network_timeout unless the value is</span>
<span class="sd">          None in which case it will be left unset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># SO_REUSEADDR: reuse the socket in TIME_WAIT state without</span>
        <span class="c1">#   waiting for its natural timeout to expire</span>
        <span class="c1">#   Allows local address reuse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># If no timeout is set then recv() will block forever if</span>
        <span class="c1">#   the connection is kept alive with no data sent</span>
        <span class="c1"># SO_RCVTIMEO: the timeout on receive calls in seconds</span>
        <span class="c1">#   set using a packed binary string containing two uint32s as</span>
        <span class="c1">#   (seconds, microseconds)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">network_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">network_timeout</span><span class="p">)</span>
            <span class="n">timeout_microsec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">network_timeout</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">SO_RCVTIMEO</span><span class="p">,</span>
                <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;ll&#39;</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">,</span> <span class="n">timeout_microsec</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Bind the socket to an (address, port)</span>
        <span class="c1">#   If address is &#39;&#39; then the socket is reachable by any</span>
        <span class="c1">#   address the machine may have, otherwise is visible only on that</span>
        <span class="c1">#   address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssociationServer.get_request"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer.get_request">[docs]</a>    <span class="k">def</span> <span class="nf">get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle a connection request.</span>

<span class="sd">        If ``ssl_context`` is set then the client socket will be wrapped using</span>
<span class="sd">        ``ssl_context.wrap_socket()``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        client_socket : socket._socket</span>
<span class="sd">            The connection request.</span>
<span class="sd">        address : 2-tuple</span>
<span class="sd">            The client&#39;s address as (host, port).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_socket</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_context</span><span class="p">:</span>
            <span class="n">client_socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span>
                                                         <span class="n">server_side</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">client_socket</span><span class="p">,</span> <span class="n">address</span></div>

<div class="viewcode-block" id="AssociationServer.process_request"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer.process_request">[docs]</a>    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a connection request.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span></div>

<div class="viewcode-block" id="AssociationServer.server_close"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer.server_close">[docs]</a>    <span class="k">def</span> <span class="nf">server_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the server.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssociationServer.shutdown"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.AssociationServer.html#pynetdicom.transport.AssociationServer.shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Completely shutdown the server and close it&#39;s socket.&quot;&quot;&quot;</span>
        <span class="n">TCPServer</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">_servers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ThreadedAssociationServer"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.ThreadedAssociationServer.html#pynetdicom.transport.ThreadedAssociationServer">[docs]</a><span class="k">class</span> <span class="nc">ThreadedAssociationServer</span><span class="p">(</span><span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">AssociationServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An AssociationServer suitable for threading.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ThreadedAssociationServer.process_request_thread"><a class="viewcode-back" href="../../reference/generated/pynetdicom.transport.ThreadedAssociationServer.html#pynetdicom.transport.ThreadedAssociationServer.process_request_thread">[docs]</a>    <span class="k">def</span> <span class="nf">process_request_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a connection request.&quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=broad-except</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finish_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-19, pynetdicom contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>