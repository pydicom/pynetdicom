

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pynetdicom.association &mdash; pynetdicom 1.4.0.dev0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/pynetdicom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pynetdicom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pynetdicom
          

          
            
            <img src="../../_static/pydicom_flat_black.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4.0.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../verification_service_class.html">Verification Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../storage_service_class.html">Storage Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../query_retrieve_service_class.html">Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic_worklist_service_class.html">Basic Worklist Management Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relevant_patient_service_class.html">Relevant Patient Information Query Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../substance_admin_service_class.html">Substance Administration Query Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../non_patient_service_class.html">Non-Patient Object Storage Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../color_palette_service_class.html">Color Palette Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../defined_procedure_service_class.html">Defined Procedure Protocol Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hanging_protocol_service_class.html">Hanging Protocol Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../implant_template_service_class.html">Implant Template Query/Retrieve Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../display_system_service_class.html">Display System Management Service Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modality_performed_procedure_step.html">Modality Performed Procedure Step Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol_approval_service_class.html">Protocol Approval Query/Retrieve Service Class</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">1.4.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html#v1-3-0">1.3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html#v1-2-0">1.2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html#v1-1-0">1.1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html#v1-0-0">1.0.0</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pynetdicom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pynetdicom.association</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pynetdicom.association</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines the Association class which handles associating with peers.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">pydicom.dataset</span> <span class="k">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">pydicom.uid</span> <span class="k">import</span> <span class="n">UID</span>

<span class="c1"># pylint: disable=no-name-in-module</span>
<span class="kn">from</span> <span class="nn">pynetdicom.acse</span> <span class="k">import</span> <span class="n">ACSE</span>
<span class="kn">from</span> <span class="nn">pynetdicom</span> <span class="k">import</span> <span class="n">_config</span><span class="p">,</span> <span class="n">evt</span>
<span class="kn">from</span> <span class="nn">pynetdicom.dimse</span> <span class="k">import</span> <span class="n">DIMSEServiceProvider</span>
<span class="kn">from</span> <span class="nn">pynetdicom.dimse_primitives</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">C_ECHO</span><span class="p">,</span> <span class="n">C_MOVE</span><span class="p">,</span> <span class="n">C_STORE</span><span class="p">,</span> <span class="n">C_GET</span><span class="p">,</span> <span class="n">C_FIND</span><span class="p">,</span> <span class="n">C_CANCEL</span><span class="p">,</span>
    <span class="n">N_EVENT_REPORT</span><span class="p">,</span> <span class="n">N_GET</span><span class="p">,</span> <span class="n">N_SET</span><span class="p">,</span> <span class="n">N_CREATE</span><span class="p">,</span> <span class="n">N_ACTION</span><span class="p">,</span> <span class="n">N_DELETE</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pynetdicom.dsutils</span> <span class="k">import</span> <span class="n">decode</span><span class="p">,</span> <span class="n">encode</span>
<span class="kn">from</span> <span class="nn">pynetdicom.dul</span> <span class="k">import</span> <span class="n">DULServiceProvider</span>
<span class="kn">from</span> <span class="nn">pynetdicom._globals</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">MODE_REQUESTOR</span><span class="p">,</span> <span class="n">MODE_ACCEPTOR</span><span class="p">,</span> <span class="n">DEFAULT_MAX_LENGTH</span><span class="p">,</span> <span class="n">STATUS_WARNING</span><span class="p">,</span>
    <span class="n">STATUS_SUCCESS</span><span class="p">,</span> <span class="n">STATUS_CANCEL</span><span class="p">,</span> <span class="n">STATUS_PENDING</span><span class="p">,</span> <span class="n">STATUS_FAILURE</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pynetdicom._handlers</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">standard_dimse_recv_handler</span><span class="p">,</span> <span class="n">standard_dimse_sent_handler</span><span class="p">,</span>
    <span class="n">standard_pdu_recv_handler</span><span class="p">,</span> <span class="n">standard_pdu_sent_handler</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pynetdicom.sop_class</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">uid_to_service_class</span><span class="p">,</span>
    <span class="n">VerificationSOPClass</span><span class="p">,</span>
    <span class="n">ModalityWorklistInformationFind</span><span class="p">,</span>
    <span class="n">PatientRootQueryRetrieveInformationModelFind</span><span class="p">,</span>
    <span class="n">StudyRootQueryRetrieveInformationModelFind</span><span class="p">,</span>
    <span class="n">PatientStudyOnlyQueryRetrieveInformationModelFind</span><span class="p">,</span>
    <span class="n">PatientRootQueryRetrieveInformationModelMove</span><span class="p">,</span>
    <span class="n">StudyRootQueryRetrieveInformationModelMove</span><span class="p">,</span>
    <span class="n">PatientStudyOnlyQueryRetrieveInformationModelMove</span><span class="p">,</span>
    <span class="n">PatientRootQueryRetrieveInformationModelGet</span><span class="p">,</span>
    <span class="n">StudyRootQueryRetrieveInformationModelGet</span><span class="p">,</span>
    <span class="n">PatientStudyOnlyQueryRetrieveInformationModelGet</span><span class="p">,</span>
    <span class="n">CompositeInstanceRetrieveWithoutBulkDataGet</span><span class="p">,</span>
    <span class="n">GeneralRelevantPatientInformationQuery</span><span class="p">,</span>
    <span class="n">BreastImagingRelevantPatientInformationQuery</span><span class="p">,</span>
    <span class="n">CardiacRelevantPatientInformationQuery</span><span class="p">,</span>
    <span class="n">ProductCharacteristicsQueryInformationModelFind</span><span class="p">,</span>
    <span class="n">SubstanceApprovalQueryInformationModelFind</span><span class="p">,</span>
    <span class="n">CompositeInstanceRootRetrieveGet</span><span class="p">,</span>
    <span class="n">CompositeInstanceRootRetrieveMove</span><span class="p">,</span>
    <span class="n">HangingProtocolInformationModelGet</span><span class="p">,</span>
    <span class="n">HangingProtocolInformationModelFind</span><span class="p">,</span>
    <span class="n">HangingProtocolInformationModelMove</span><span class="p">,</span>
    <span class="n">DefinedProcedureProtocolInformationModelGet</span><span class="p">,</span>
    <span class="n">DefinedProcedureProtocolInformationModelFind</span><span class="p">,</span>
    <span class="n">DefinedProcedureProtocolInformationModelMove</span><span class="p">,</span>
    <span class="n">ColorPaletteInformationModelGet</span><span class="p">,</span>
    <span class="n">ColorPaletteInformationModelFind</span><span class="p">,</span>
    <span class="n">ColorPaletteInformationModelMove</span><span class="p">,</span>
    <span class="n">GenericImplantTemplateInformationModelGet</span><span class="p">,</span>
    <span class="n">GenericImplantTemplateInformationModelFind</span><span class="p">,</span>
    <span class="n">GenericImplantTemplateInformationModelMove</span><span class="p">,</span>
    <span class="n">ImplantAssemblyTemplateInformationModelGet</span><span class="p">,</span>
    <span class="n">ImplantAssemblyTemplateInformationModelFind</span><span class="p">,</span>
    <span class="n">ImplantAssemblyTemplateInformationModelMove</span><span class="p">,</span>
    <span class="n">ImplantTemplateGroupInformationModelFind</span><span class="p">,</span>
    <span class="n">ImplantTemplateGroupInformationModelGet</span><span class="p">,</span>
    <span class="n">ImplantTemplateGroupInformationModelMove</span><span class="p">,</span>
    <span class="n">ProtocolApprovalInformationModelFind</span><span class="p">,</span>
    <span class="n">ProtocolApprovalInformationModelGet</span><span class="p">,</span>
    <span class="n">ProtocolApprovalInformationModelMove</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pynetdicom.pdu_primitives</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">UserIdentityNegotiation</span><span class="p">,</span>
    <span class="n">MaximumLengthNotification</span><span class="p">,</span>
    <span class="n">ImplementationClassUIDNotification</span><span class="p">,</span>
    <span class="n">ImplementationVersionNameNotification</span><span class="p">,</span>
    <span class="n">AsynchronousOperationsWindowNegotiation</span><span class="p">,</span>
    <span class="n">SOPClassExtendedNegotiation</span><span class="p">,</span>
    <span class="n">SOPClassCommonExtendedNegotiation</span><span class="p">,</span>
    <span class="n">SCP_SCU_RoleSelectionNegotiation</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pynetdicom.status</span> <span class="k">import</span> <span class="n">code_to_category</span><span class="p">,</span> <span class="n">STORAGE_SERVICE_CLASS_STATUS</span>


<span class="c1"># pylint: enable=no-name-in-module</span>
<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pynetdicom.assoc&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Association"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association">[docs]</a><span class="k">class</span> <span class="nc">Association</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Manage an Association with a peer AE.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    acceptor : association.ServiceUser</span>
<span class="sd">        Representation of the association&#39;s acceptor AE.</span>
<span class="sd">    acse : acse.ACSE</span>
<span class="sd">        The Association Control Service Element provider.</span>
<span class="sd">    ae : ae.ApplicationEntity</span>
<span class="sd">        The local AE.</span>
<span class="sd">    dimse : dimse.DIMSEServiceProvider</span>
<span class="sd">        The DICOM Message Service Element provider.</span>
<span class="sd">    dul : dul.DULServiceProvider</span>
<span class="sd">        The DICOM Upper Layer service provider.</span>
<span class="sd">    is_aborted : bool</span>
<span class="sd">        ``True`` if the association has been aborted, ``False`` otherwise.</span>
<span class="sd">    is_established : bool</span>
<span class="sd">        ``True`` if the association has been established, ``False`` otherwise.</span>
<span class="sd">    is_rejected : bool</span>
<span class="sd">        ``True`` if the association was rejected, ``False`` otherwise.</span>
<span class="sd">    is_released : bool</span>
<span class="sd">        ``True`` if the association has been released, ``False`` otherwise.</span>
<span class="sd">    mode : str</span>
<span class="sd">        The mode of the local AE, either the association &#39;requestor&#39; or</span>
<span class="sd">        association &#39;acceptor&#39;.</span>
<span class="sd">    requestor : association.ServiceUser</span>
<span class="sd">        Representation of the association&#39;s requestor AE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Association.__init__"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ae</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ``Association`` instance.</span>

<span class="sd">        The association starts in State 1 (idle). Association negotiation</span>
<span class="sd">        won&#39;t begin until an ``AssociationSocket`` is assigned using</span>
<span class="sd">        ``set_socket()`` and ``Association.start_server()`` is called.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ae : ae.ApplicationEntity</span>
<span class="sd">            The local AE.</span>
<span class="sd">        mode : str</span>
<span class="sd">            Must be ``&quot;requestor&quot;`` or ``&quot;acceptor&quot;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ae</span> <span class="o">=</span> <span class="n">ae</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>

        <span class="c1"># If acceptor this is the parent AssociationServer, used to identify</span>
        <span class="c1">#   the thread when updating bound event-handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Represents the association requestor and acceptor users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requestor</span> <span class="o">=</span> <span class="n">ServiceUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MODE_REQUESTOR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptor</span> <span class="o">=</span> <span class="n">ServiceUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MODE_ACCEPTOR</span><span class="p">)</span>

        <span class="c1"># Status attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_aborted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_released</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Accepted and rejected presentation contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accepted_cx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rejected_cx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Service providers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acse</span> <span class="o">=</span> <span class="n">ACSE</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dul</span> <span class="o">=</span> <span class="n">DULServiceProvider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span> <span class="o">=</span> <span class="n">DIMSEServiceProvider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Timeouts (in seconds), needs to be set after DUL init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acse_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">acse_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">dimse_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">network_timeout</span>

        <span class="c1"># Event handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bind_defaults</span><span class="p">()</span>

        <span class="c1"># Kills the thread loop in run()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Flag for whether or not the DUL thread has been started</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started_dul</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Used to pause the association reactor until the DUL is ready</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dul_ready</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="c1"># Used to pause the association reactor while a service is being used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># Thread setup</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Association.abort"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an A-ABORT to the remote AE and kill the ``Association``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_released</span><span class="p">:</span>
            <span class="c1"># Ensure the reactor is running so it can be exited</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Aborting Association&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">send_abort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
            <span class="c1"># Event handler - association aborted</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">EVT_ABORTED</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

        <span class="c1"># Add short delay to ensure everything shuts down</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">accepted_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of accepted ``PresentationContexts``.&quot;&quot;&quot;</span>
        <span class="c1"># Accepted contexts are stored internally as {context ID : context}</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_accepted_cx</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">acse_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the ACSE timeout in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acse_timeout</span>

    <span class="nd">@acse_timeout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">acse_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the ACSE timeout using numeric or ``None``.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">artim_timer</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_acse_timeout</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ae</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Association&#39;s parent ``ApplicationEntity``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ae</span>

<div class="viewcode-block" id="Association.bind"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bind a callable `handler` to an `event`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : namedtuple</span>
<span class="sd">            The event to bind the function to.</span>
<span class="sd">        handler : callable</span>
<span class="sd">            The function that will be called if the event occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure no access to `_handlers` while its being changed</span>
        <span class="k">with</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="c1"># Notification events - multiple handlers allowed</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_notification</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">handler</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

            <span class="c1"># Intervention events - only one handler allowed</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_intervention</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">!=</span> <span class="n">handler</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span></div>

    <span class="k">def</span> <span class="nf">_bind_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bind the default event handlers.&quot;&quot;&quot;</span>
        <span class="c1"># Intervention event handlers</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">evt</span><span class="o">.</span><span class="n">_INTERVENTION_EVENTS</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">get_default_handler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>

        <span class="c1"># Notification event handlers</span>
        <span class="k">if</span> <span class="n">_config</span><span class="o">.</span><span class="n">LOG_HANDLER_LEVEL</span> <span class="o">==</span> <span class="s1">&#39;standard&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">EVT_DIMSE_RECV</span><span class="p">,</span> <span class="n">standard_dimse_recv_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">EVT_DIMSE_SENT</span><span class="p">,</span> <span class="n">standard_dimse_sent_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">EVT_PDU_RECV</span><span class="p">,</span> <span class="n">standard_pdu_recv_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">EVT_PDU_SENT</span><span class="p">,</span> <span class="n">standard_pdu_sent_handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_received_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a pydicom ``Dataset`` containing status related elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rsp : dimse_primitives.DIMSEMessage</span>
<span class="sd">            The DIMSE Message primitive received from the peer in response</span>
<span class="sd">            to a service request.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pydicom.dataset.Dataset</span>
<span class="sd">            If no response or an invalid response was received from the peer</span>
<span class="sd">            then an empty ``Dataset``, if a valid response was received from</span>
<span class="sd">            the peer then (at a minimum) a ``Dataset`` containing an</span>
<span class="sd">            (0000,0900) *Status* element, and any included optional status</span>
<span class="sd">            related elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">msg_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rsp</span><span class="o">.</span><span class="n">is_valid_response</span><span class="p">:</span>
            <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">rsp</span><span class="o">.</span><span class="n">STATUS_OPTIONAL_KEYWORDS</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">keyword</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Received an invalid </span><span class="si">{}</span><span class="s2"> response from the peer&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_type</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">status</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimse_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the DIMSE timeout in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimse_timeout</span>

    <span class="nd">@dimse_timeout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dimse_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the DIMSE timeout using numeric or ``None``.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dimse_timeout</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Association.get_events"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.get_events">[docs]</a>    <span class="k">def</span> <span class="nf">get_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of currently bound events.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Association.get_handlers"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.get_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">get_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return handlers bound to a specific `event`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : namedtuple</span>
<span class="sd">            The event bound to the handlers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        callable, list of callable or None</span>
<span class="sd">            If the event is a notification event then returns a list of</span>
<span class="sd">            callable functions bound to `event`, if the event is an</span>
<span class="sd">            intervention event then returns either a callable function if a</span>
<span class="sd">            handler is bound to the event or None if no handler has been bound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_valid_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ab_syntax</span><span class="p">,</span> <span class="n">tr_syntax</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">context_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a valid presentation context matching the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ab_syntax : str or pydicom.uid.UID</span>
<span class="sd">            The abstract syntax to match.</span>
<span class="sd">        tr_syntax : str or pydicom.uid.UID</span>
<span class="sd">            The transfer syntax to match, if an empty string is used then</span>
<span class="sd">            the transfer syntax will not be used for matching. If the value</span>
<span class="sd">            corresponds to an uncompressed syntax then matches will be made</span>
<span class="sd">            with any uncompressed transfer syntaxes.</span>
<span class="sd">        role : str</span>
<span class="sd">            One of &#39;scu&#39; or &#39;scp&#39;, the required role of the context.</span>
<span class="sd">        context_id : int or None</span>
<span class="sd">            If not None then the ID of the presentation context to use. It will</span>
<span class="sd">            be checked against the available parameter values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        presentation.PresentationContext</span>
<span class="sd">            An accepted presentation context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ab_syntax</span> <span class="o">=</span> <span class="n">UID</span><span class="p">(</span><span class="n">ab_syntax</span><span class="p">)</span>
        <span class="n">tr_syntax</span> <span class="o">=</span> <span class="n">UID</span><span class="p">(</span><span class="n">tr_syntax</span><span class="p">)</span>

        <span class="n">possible_contexts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">context_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">possible_contexts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_contexts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_contexts</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cx</span><span class="o">.</span><span class="n">context_id</span> <span class="o">==</span> <span class="n">context_id</span><span class="p">:</span>
                    <span class="n">possible_contexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">cx</span><span class="p">]</span>
                    <span class="k">break</span>

        <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">possible_contexts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cx</span><span class="o">.</span><span class="n">abstract_syntax</span> <span class="o">!=</span> <span class="n">ab_syntax</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Cover both False and None</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;scu&#39;</span> <span class="ow">and</span> <span class="n">cx</span><span class="o">.</span><span class="n">as_scu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;scp&#39;</span> <span class="ow">and</span> <span class="n">cx</span><span class="o">.</span><span class="n">as_scp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Allow us to skip the transfer syntax check</span>
            <span class="k">if</span> <span class="n">tr_syntax</span> <span class="ow">and</span> <span class="n">tr_syntax</span> <span class="o">!=</span> <span class="n">cx</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># Compressed transfer syntaxes are not convertable</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tr_syntax</span><span class="o">.</span><span class="n">is_compressed</span>
                        <span class="ow">or</span> <span class="n">cx</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_compressed</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="c1"># Only a valid presentation context can reach this point</span>
            <span class="k">return</span> <span class="n">cx</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;No suitable presentation context for the </span><span class="si">{}</span><span class="s2"> role has been &quot;</span>
            <span class="s2">&quot;accepted by the peer for the SOP Class &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ab_syntax</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tr_syntax</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; with a transfer syntax of &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tr_syntax</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_acceptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` if the local AE is the association *Acceptor*.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_ACCEPTOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_requestor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` if the local AE is the association *Requestor*.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_REQUESTOR</span>

<div class="viewcode-block" id="Association.kill"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.kill">[docs]</a>    <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Kill the ``Association`` thread.&quot;&quot;&quot;</span>
        <span class="c1"># Ensure the reactor is running so it can be exited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kill</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">stop_dul</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dict with information about the local AE.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">info</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">requestor</span><span class="o">.</span><span class="n">info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Association&#39;s `mode` as a str.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>

    <span class="nd">@mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the Association&#39;s mode.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode : str</span>
<span class="sd">            The mode of the Association, must be either ``&quot;requestor&quot;`` or</span>
<span class="sd">            ``&quot;acceptor&quot;``. If ``&quot;requestor&quot;`` then its assumed that the local</span>
<span class="sd">            AE requests an association with peers and (by default) acts as the</span>
<span class="sd">            SCU. If ``&quot;acceptor&quot;`` then its assumed that the local AE is</span>
<span class="sd">            listening for association requests and (by default) acts as the SCP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MODE_REQUESTOR</span><span class="p">,</span> <span class="n">MODE_ACCEPTOR</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid association `mode` value, must be either &#39;requestor&#39; &quot;</span>
                <span class="s2">&quot;or &#39;acceptor&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># pylint: disable=attribute-defined-outside-init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">network_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the network timeout in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_timeout</span>

    <span class="nd">@network_timeout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">network_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the network timeout using numeric or ``None``.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">_idle_timer</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_network_timeout</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rejected_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of rejected ``PresentationContext``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rejected_cx</span>

<div class="viewcode-block" id="Association.release"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.release">[docs]</a>    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an A-RELEASE request and initiate association release.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="c1"># Ensure the reactor is running</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Releasing Association&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">negotiate_release</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dict with information about the peer AE.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">requestor</span><span class="o">.</span><span class="n">info</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">info</span>

<div class="viewcode-block" id="Association.request"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.request">[docs]</a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Request an association with a peer.</span>

<span class="sd">        A request can only be made once the ``Association`` instance has been</span>
<span class="sd">        configured for requestor mode and been assigned an</span>
<span class="sd">        ``AssociationSocket``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Start the DUL thread if not already started</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started_dul</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Wait until the DUL is up and running</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dul_ready</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="c1"># Start association negotiation</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Requesting Association&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">negotiate_association</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Association.run"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The main ``Association`` reactor.&quot;&quot;&quot;</span>
        <span class="c1"># Start the DUL thread if not already started</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started_dul</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_started_dul</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Wait until the DUL is up and running</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dul_ready</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="n">primitive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">receive_pdu</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acse_timeout</span><span class="p">)</span>

            <span class="c1"># Timed out waiting for A-ASSOCIATE request</span>
            <span class="k">if</span> <span class="n">primitive</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">requestor</span><span class="o">.</span><span class="n">primitive</span> <span class="o">=</span> <span class="n">primitive</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">EVT_REQUESTED</span><span class="p">,</span> <span class="p">{})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">negotiate_association</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_as_acceptor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Association requestor</span>
            <span class="c1"># Allow non-blocking negotiation</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_aborted</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_released</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">negotiate_association</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_as_requestor</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_run_as_acceptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the ``Association`` acceptor reactor loop.</span>

<span class="sd">        Main acceptor run loop</span>
<span class="sd">        1. Checks for incoming DIMSE messages</span>
<span class="sd">            If DIMSE message then run corresponding service class&#39; SCP</span>
<span class="sd">            method</span>
<span class="sd">        2. Checks for peer A-RELEASE request primitive</span>
<span class="sd">            If present then kill thread</span>
<span class="sd">        3. Checks for peer A-ABORT request primitive</span>
<span class="sd">            If present then kill thread</span>
<span class="sd">        4. Checks DUL provider still running</span>
<span class="sd">            If not then kill thread</span>
<span class="sd">        5. Checks DUL idle timeout</span>
<span class="sd">            If timed out then kill thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kill</span><span class="p">:</span>
            <span class="c1"># A race condition may occur if the Acceptor uses the send_*()</span>
            <span class="c1">#   methods as the received DIMSE message may be taken off the</span>
            <span class="c1">#   queue before the send_*() method gets to it, so we allow</span>
            <span class="c1">#   the reactor to be paused</span>
            <span class="c1"># Will block until `_reactor_checkpoint` is True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>

            <span class="c1"># Check with the DIMSE provider to see if a completely decoded</span>
            <span class="c1">#   message is available</span>
            <span class="n">msg_context_id</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># DIMSE message received, should be a service request</span>
            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
                <span class="c1"># Use the Message&#39;s Affected SOP Class UID or Requested SOP</span>
                <span class="c1">#   Class UID to determine which service to use</span>
                <span class="c1"># If there&#39;s no AffectedSOPClassUID or RequestedSOPClassUID</span>
                <span class="c1">#   then we received a C-CANCEL request</span>
                <span class="n">class_uid</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;AffectedSOPClassUID&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># DIMSE-C, N-EVENT-REPORT, N-CREATE use AffectedSOPClassUID</span>
                    <span class="n">class_uid</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span>
                <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;RequestedSOPClassUID&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># N-GET, N-SET, N-ACTION, N-DELETE use RequestedSOPClassUID</span>
                    <span class="n">class_uid</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">RequestedSOPClassUID</span>

                <span class="c1"># SOP Class Common Extended Negotiation</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># The service class UID</span>
                    <span class="n">class_uid</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">acceptor</span><span class="o">.</span><span class="n">accepted_common_extended</span><span class="p">[</span><span class="n">class_uid</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># Convert the SOP/Service UID to the corresponding service</span>
                <span class="n">service_class</span> <span class="o">=</span> <span class="n">uid_to_service_class</span><span class="p">(</span><span class="n">class_uid</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accepted_cx</span><span class="p">[</span><span class="n">msg_context_id</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Received DIMSE message with invalid or rejected &quot;</span>
                        <span class="s2">&quot;context ID: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">msg_context_id</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="c1"># Run corresponding Service Class in SCP mode</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Clear out any C-CANCEL requests received beforehand</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">cancel_req</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">service_class</span><span class="o">.</span><span class="n">SCP</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="c1"># Clear out any unacted upon requests received during</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">cancel_req</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                    <span class="c1"># SCP isn&#39;t implemented</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;No supported service class available for the SOP &quot;</span>
                        <span class="s2">&quot;Class UID &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_uid</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                    <span class="k">return</span>

            <span class="c1"># Check for release request</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">is_release_requested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="c1"># Send A-RELEASE response</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">send_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_response</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Association Released&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_released</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">EVT_RELEASED</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check for abort</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">is_aborted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Association Aborted&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_aborted</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">EVT_ABORTED</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check if the DULServiceProvider thread is still running</span>
            <span class="c1">#   DUL.is_alive() is inherited from threading.thread</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check if idle timer has expired</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">idle_timer_expired</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_run_as_requestor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the association as the requestor.&quot;&quot;&quot;</span>
        <span class="c1"># Listen for further messages from the peer</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kill</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="c1"># Check for release request</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">is_release_requested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="c1"># Send A-RELEASE response</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">send_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_response</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Association Released&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_released</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">EVT_RELEASED</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check for abort</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acse</span><span class="o">.</span><span class="n">is_aborted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Association Aborted&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_aborted</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">EVT_ABORTED</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check if the DULServiceProvider thread is</span>
            <span class="c1">#   still running. DUL.is_alive() is inherited from</span>
            <span class="c1">#   threading.thread</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check if idle timer has expired</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">idle_timer_expired</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">return</span>

<div class="viewcode-block" id="Association.set_socket"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.set_socket">[docs]</a>    <span class="k">def</span> <span class="nf">set_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the socket to use for communicating with the peer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        socket : transport.AssociationSocket</span>
<span class="sd">            The socket to use.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If the Association already has a socket set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The Association already has a socket set.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dul</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span></div>

<div class="viewcode-block" id="Association.unbind"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.unbind">[docs]</a>    <span class="k">def</span> <span class="nf">unbind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unbind a callable `func` from an `event`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : namedtuple</span>
<span class="sd">            The event to unbind the function from.</span>
<span class="sd">        handler : callable</span>
<span class="sd">            The function that will no longer be called if the event occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Make sure no access to `_handlers` while its being changed</span>
        <span class="k">with</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="c1"># Notification events</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_notification</span> <span class="ow">and</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span>

            <span class="c1"># Intervention events - unbind and replace with default</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_intervention</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">==</span> <span class="n">handler</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">get_default_handler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

    <span class="c1"># DIMSE-C services provided by the Association</span>
    <span class="k">def</span> <span class="nf">_c_store_scp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A C-STORE SCP implementation.</span>

<span class="sd">        Handles C-STORE requests from the peer over the same assocation as the</span>
<span class="sd">        local AE sent a C-MOVE or C-GET request.</span>

<span class="sd">        Must always send a C-STORE response back to the peer.</span>

<span class="sd">        C-STORE Request</span>
<span class="sd">        ---------------</span>
<span class="sd">        Parameters</span>
<span class="sd">        ~~~~~~~~~~</span>
<span class="sd">        (M) Message ID</span>
<span class="sd">        (M) Affected SOP Class UID</span>
<span class="sd">        (M) Affected SOP Instance UID</span>
<span class="sd">        (M) Priority</span>
<span class="sd">        (U) Move Originator Application Entity Title</span>
<span class="sd">        (U) Move Originator Message ID</span>
<span class="sd">        (M) Data Set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        req : dimse_primitives.C_STORE</span>
<span class="sd">            The C-STORE request primitive received from the peer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build C-STORE response primitive</span>
        <span class="c1">#   (U) Message ID</span>
        <span class="c1">#   (M) Message ID Being Responded To</span>
        <span class="c1">#   (U) Affected SOP Class UID</span>
        <span class="c1">#   (U) Affected SOP Instance UID</span>
        <span class="c1">#   (M) Status</span>
        <span class="n">rsp</span> <span class="o">=</span> <span class="n">C_STORE</span><span class="p">()</span>
        <span class="n">rsp</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span>
        <span class="n">rsp</span><span class="o">.</span><span class="n">MessageIDBeingRespondedTo</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span>
        <span class="n">rsp</span><span class="o">.</span><span class="n">AffectedSOPInstanceUID</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPInstanceUID</span>
        <span class="n">rsp</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span>
                <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;scp&#39;</span><span class="p">,</span>
                <span class="n">context_id</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">_context_id</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># SOP Class not supported, no context ID?</span>
            <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0x0122</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Attempt to handle the service request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">evt</span><span class="o">.</span><span class="n">EVT_C_STORE</span><span class="p">,</span>
                <span class="p">{</span><span class="s1">&#39;request&#39;</span> <span class="p">:</span> <span class="n">req</span><span class="p">,</span> <span class="s1">&#39;context&#39;</span> <span class="p">:</span> <span class="n">context</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Exception in the handler bound to &#39;evt.EVT_C_STORE&#39;&quot;</span>
            <span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0xC211</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Check the callback&#39;s returned status</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Status&#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
                <span class="c1"># For the elements in the status dataset, try and set</span>
                <span class="c1">#   the corresponding response primitive attribute</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">keyword</span><span class="p">):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">keyword</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Status dataset returned by &quot;</span>
                                       <span class="s2">&quot;callback contained an &quot;</span>
                                       <span class="s2">&quot;unsupported element &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
                                       <span class="n">elem</span><span class="o">.</span><span class="n">keyword</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User callback returned a `Dataset` &quot;</span>
                             <span class="s2">&quot;without a Status element.&quot;</span><span class="p">)</span>
                <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0xC001</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid status returned by user callback.&quot;</span><span class="p">)</span>
            <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0xC002</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span> <span class="ow">in</span> <span class="n">STORAGE_SERVICE_CLASS_STATUS</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown status value returned by callback &quot;</span>
                           <span class="s2">&quot;- 0x</span><span class="si">{0:04x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">Status</span><span class="p">))</span>

        <span class="c1"># Send C-STORE confirmation back to peer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>

<div class="viewcode-block" id="Association.send_c_cancel"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_c_cancel">[docs]</a>    <span class="k">def</span> <span class="nf">send_c_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_id</span><span class="p">,</span> <span class="n">context_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a C-CANCEL request to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg_id : int</span>
<span class="sd">            The *Message ID* of the C-GET/C-MOVE/C-FIND operation to be</span>
<span class="sd">            cancelled. Must be between 0 and 65535, inclusive.</span>
<span class="sd">        context_id : int</span>
<span class="sd">            The presentation context ID of the original C-GET/C-MOVE/C-FIND</span>
<span class="sd">            service request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send a C-CANCEL without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be &quot;</span>
                <span class="s2">&quot;established before sending a C-CANCEL request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Build C-CANCEL primitive</span>
        <span class="n">primitive</span> <span class="o">=</span> <span class="n">C_CANCEL</span><span class="p">()</span>
        <span class="n">primitive</span><span class="o">.</span><span class="n">MessageIDBeingRespondedTo</span> <span class="o">=</span> <span class="n">msg_id</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending C-CANCEL&#39;</span><span class="p">)</span>

        <span class="c1"># Send C-CANCEL request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">primitive</span><span class="p">,</span> <span class="n">context_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Association.send_c_echo"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_c_echo">[docs]</a>    <span class="k">def</span> <span class="nf">send_c_echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a C-ECHO request to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The DIMSE *Message ID*, must be between 0 and 65535, inclusive,</span>
<span class="sd">            (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a valid response was received from</span>
<span class="sd">            the peer then returns a ``Dataset`` containing at least a</span>
<span class="sd">            (0000,0900) *Status* element, and, depending on the returned</span>
<span class="sd">            *Status* value, may optionally contain additional elements (see</span>
<span class="sd">            DICOM Standard Part 7, Annex C).</span>

<span class="sd">            The DICOM Standard Part 7, Table 9.3-13 indicates that the Status</span>
<span class="sd">            value of a C-ECHO response &quot;shall have a value of Success&quot;. However</span>
<span class="sd">            Section 9.1.5.1.4 indicates it may have any of the following</span>
<span class="sd">            values:</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Success</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>

<span class="sd">            As the actual status depends on the peer SCP, it shouldn&#39;t be</span>
<span class="sd">            assumed that it will be one of these.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If called without an association to a peer SCP.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the association has no accepted Presentation Context for</span>
<span class="sd">            &#39;Verification SOP Class&#39;.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.C_ECHO</span>
<span class="sd">        service_class.VerificationServiceClass</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standard Part 4, `Annex A &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_A&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `9.1.5 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.1.5&gt;`_,</span>
<span class="sd">          `9.3.5 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.3.5&gt;`_,</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send a C-ECHO without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The association with a peer SCP must be &quot;</span>
                               <span class="s2">&quot;established before sending a C-ECHO request&quot;</span><span class="p">)</span>

        <span class="c1"># Get a Presentation Context to use for sending the message</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">VerificationSOPClass</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>

        <span class="c1"># Build C-STORE request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="n">primitive</span> <span class="o">=</span> <span class="n">C_ECHO</span><span class="p">()</span>
        <span class="n">primitive</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">primitive</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">VerificationSOPClass</span>

        <span class="c1"># Send C-ECHO request to the peer via DIMSE and wait for the response</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Echo Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">primitive</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">()</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="Association.send_c_find"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_c_find">[docs]</a>    <span class="k">def</span> <span class="nf">send_c_find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">query_model</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a C-FIND request to the peer AE.</span>

<span class="sd">        Yields ``(status, identifier)`` pairs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset</span>
<span class="sd">            The C-FIND request&#39;s *Identifier* dataset. The exact requirements</span>
<span class="sd">            for the *Identifier* dataset are Service Class specific (see the</span>
<span class="sd">            DICOM Standard, Part 4).</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The DIMSE *Message ID*, must be between 0 and 65535, inclusive,</span>
<span class="sd">            (default 1).</span>
<span class="sd">        priority : int, optional</span>
<span class="sd">            The C-FIND operation *Priority* (may not be supported by the peer),</span>
<span class="sd">            one of:</span>

<span class="sd">            - ``0`` - Medium</span>
<span class="sd">            - ``1`` - High</span>
<span class="sd">            - ``2`` - Low (default)</span>

<span class="sd">        query_model : str, optional</span>
<span class="sd">            The Information Model to use, one of the following:</span>

<span class="sd">            - ``P`` - 1.2.840.10008.5.1.4.1.2.1.1  -</span>
<span class="sd">              *Patient Root Information Model - FIND* (default)</span>
<span class="sd">            - ``S`` - 1.2.840.10008.5.1.4.1.2.2.1 -</span>
<span class="sd">              *Study Root Information Model - FIND*</span>
<span class="sd">            - ``O`` - 1.2.840.10008.5.1.4.1.2.3.1 -</span>
<span class="sd">              *Patient Study Only Information Model - FIND*</span>
<span class="sd">            - ``W`` - 1.2.840.10008.5.1.4.31 -</span>
<span class="sd">              *Modality Worklist Information - FIND*</span>
<span class="sd">            - ``G`` - 1.2.840.10008.5.1.4.37.1 -</span>
<span class="sd">              *General Relevant Patient Information Query*</span>
<span class="sd">            - ``B`` - 1.2.840.10008.5.1.4.37.2 -</span>
<span class="sd">              *Breast Imaging Relevant Patient Information Query*</span>
<span class="sd">            - ``C`` - 1.2.840.10008.5.1.4.37.3 -</span>
<span class="sd">              *Cardiac Relevant Patient Information Query*</span>
<span class="sd">            - ``PC`` - 1.2.840.10008.5.1.4.41 -</span>
<span class="sd">              *Product Characteristics Query Information Model - FIND*</span>
<span class="sd">            - ``SA`` - 1.2.840.10008.5.1.4.42 -</span>
<span class="sd">              *Substance Approval Query Information Model - FIND*</span>
<span class="sd">            - ``H`` - 1.2.840.10008.5.1.4.38.2 -</span>
<span class="sd">              *Hanging Protocol Information Model - FIND*</span>
<span class="sd">            - ``D`` - 1.2.840.10008.5.1.4.20.1 -</span>
<span class="sd">              *Defined Procedure Protocol Information Model - FIND*</span>
<span class="sd">            - ``CP`` - 1.2.840.10008.5.1.4.39.2 -</span>
<span class="sd">              *Color Palette Information Model - FIND*</span>
<span class="sd">            - ``IG`` - 1.2.840.10008.5.1.4.43.2 -</span>
<span class="sd">              *Generic Implant Template Information Model - FIND*</span>
<span class="sd">            - ``IA`` - 1.2.840.10008.5.1.4.44.2 -</span>
<span class="sd">              *Implant Assembly Template Information Model - FIND*</span>
<span class="sd">            - ``IT`` - 1.2.840.10008.5.1.4.44.2 -</span>
<span class="sd">              *Implant Template Group Information Model - FIND*</span>
<span class="sd">            - ``PA`` - 1.2.840.10008.5.1.4.1.1.200.4 -</span>
<span class="sd">              *Protocol Approval Information Model - FIND*</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            yields an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then yields a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            The status for the requested C-FIND operation should be one of the</span>
<span class="sd">            following values, but as the value depends</span>
<span class="sd">            on the peer this can&#39;t be assumed:</span>

<span class="sd">            *General C-FIND* (Part 7, Section 9.1.2.1.5 and Annex C)</span>

<span class="sd">            Cancel</span>
<span class="sd">              | ``0xFE00`` - Matching terminated due to Cancel request</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Matching is complete: no final Identifier is</span>
<span class="sd">                supplied</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>

<span class="sd">            *Query/Retrieve Service, Basic Worklist Management Service,</span>
<span class="sd">            Hanging Protocol Query/Retrieve Service, Defined Procedure Protocol</span>
<span class="sd">            Query/Retrieve Service, Substance Administration Query Service,</span>
<span class="sd">            Color Palette Query/Retrieve Service*, *Implant Template</span>
<span class="sd">            Query/Retrieve Service* and *Protocol Approval Query/Retrieve</span>
<span class="sd">            Service* specific</span>
<span class="sd">            (DICOM Standard Part 4, Annexes C.4.1, K.4.1.1.4, U.4.1, HH,</span>
<span class="sd">            V.4.1.1.4, X, BB and II):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA700`` - Out of resources</span>
<span class="sd">              | ``0xA900`` - Identifier does not match SOP Class</span>
<span class="sd">              | ``0xC000`` to ``0xCFFF`` - Unable to process</span>

<span class="sd">            Pending</span>
<span class="sd">              | ``0xFF00`` - Matches are continuing: current match is supplied</span>
<span class="sd">                and any Optional Keys were supported in the same manner as</span>
<span class="sd">                Required Keys</span>
<span class="sd">              | ``0xFF01`` - Matches are continuing: warning that one or more</span>
<span class="sd">                Optional Keys were not supported for existence and/or matching</span>
<span class="sd">                for this Identifier)</span>

<span class="sd">            *Relevant Patient Information Query Service* specific (DICOM</span>
<span class="sd">            Standard Part 4, Annex Q.2.1.1.4):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA700`` - Out of resources</span>
<span class="sd">              | ``0xA900`` - Identifier does not match SOP Class</span>
<span class="sd">              | ``0xC000`` - Unable to process</span>
<span class="sd">              | ``0xC100`` - More than one match found</span>
<span class="sd">              | ``0xC200`` - Unable to support requested template</span>

<span class="sd">            Pending</span>
<span class="sd">              | ``0xFF00`` - Matches are continuing: current match is supplied</span>
<span class="sd">                and any Optional Keys were supported in the same manner as</span>
<span class="sd">                Required Keys</span>

<span class="sd">        identifier : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Pending&#39; then the C-FIND response&#39;s</span>
<span class="sd">            *Identifier* ``Dataset``. If the status category is not &#39;Pending&#39;</span>
<span class="sd">            this will be ``None``. The exact contents of the response</span>
<span class="sd">            *Identifier* are Service Class specific (see the DICOM Standard,</span>
<span class="sd">            Part 4).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If ``send_c_find`` is called with no established association.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If no accepted Presentation Context for `dataset` exists or if</span>
<span class="sd">            unable to encode the *Identifier* `dataset`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.C_FIND</span>
<span class="sd">        service_class.QueryRetrieveFindServiceClass</span>
<span class="sd">        service_class.RelevantPatientInformationQueryServiceClass</span>
<span class="sd">        service_class.SubstanceAdministrationQueryServiceClass</span>
<span class="sd">        service_class.HangingProtocolQueryRetrieveServiceClass</span>
<span class="sd">        service_class.DefinedProcedureProtocolQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ColorPaletteQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ImplantTemplateQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ProtocolApprovalQueryRetrieveServiceClass</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standard Part 4, `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_C&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex Q &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_Q&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex U &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_U&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex V &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_V&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex X &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_X&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex BB &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_BB&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex HH &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_HH&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex II &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_II&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `9.1.2 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.1.2&gt;`_,</span>
<span class="sd">          `9.3.2 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.3.2&gt;`_,</span>
<span class="sd">          Annexes `C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">          and `K &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_K&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send a C-FIND without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The association with a peer SCP must be &quot;</span>
                               <span class="s2">&quot;established before sending a C-FIND request&quot;</span><span class="p">)</span>

        <span class="n">_sop_classes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;W&#39;</span> <span class="p">:</span> <span class="n">ModalityWorklistInformationFind</span><span class="p">,</span>
            <span class="s2">&quot;P&quot;</span> <span class="p">:</span> <span class="n">PatientRootQueryRetrieveInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;S&quot;</span> <span class="p">:</span> <span class="n">StudyRootQueryRetrieveInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;O&quot;</span> <span class="p">:</span> <span class="n">PatientStudyOnlyQueryRetrieveInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;G&quot;</span> <span class="p">:</span> <span class="n">GeneralRelevantPatientInformationQuery</span><span class="p">,</span>
            <span class="s2">&quot;B&quot;</span> <span class="p">:</span> <span class="n">BreastImagingRelevantPatientInformationQuery</span><span class="p">,</span>
            <span class="s2">&quot;C&quot;</span> <span class="p">:</span> <span class="n">CardiacRelevantPatientInformationQuery</span><span class="p">,</span>
            <span class="s2">&quot;PC&quot;</span> <span class="p">:</span> <span class="n">ProductCharacteristicsQueryInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;SA&quot;</span> <span class="p">:</span> <span class="n">SubstanceApprovalQueryInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;H&quot;</span> <span class="p">:</span> <span class="n">HangingProtocolInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;D&quot;</span> <span class="p">:</span> <span class="n">DefinedProcedureProtocolInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;CP&quot;</span> <span class="p">:</span> <span class="n">ColorPaletteInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;IG&quot;</span> <span class="p">:</span> <span class="n">GenericImplantTemplateInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;IA&quot;</span> <span class="p">:</span> <span class="n">ImplantAssemblyTemplateInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;IT&quot;</span> <span class="p">:</span> <span class="n">ImplantTemplateGroupInformationModelFind</span><span class="p">,</span>
            <span class="s2">&quot;PA&quot;</span> <span class="p">:</span> <span class="n">ProtocolApprovalInformationModelFind</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sop_class</span> <span class="o">=</span> <span class="n">_sop_classes</span><span class="p">[</span><span class="n">query_model</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported value for `query_model`: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query_model</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">sop_class</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>

        <span class="c1"># Build C-FIND request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="c1">#   (M) Priority</span>
        <span class="c1">#   (M) Identifier</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">C_FIND</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">sop_class</span>
        <span class="n">req</span><span class="o">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="n">priority</span>

        <span class="c1"># Encode the Identifier `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">Identifier</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to encode the supplied Dataset&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Failed to encode the supplied Dataset&#39;</span><span class="p">)</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Find Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;# Identifier DICOM Dataset&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Send C-FIND request to the peer via DIMSE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>

        <span class="c1"># Get the responses from the peer</span>
        <span class="c1"># Wrap the generator so the C-FIND-RQ is sent immediately on</span>
        <span class="c1">#   executing this function, otherwise sending C-CANCEL requests</span>
        <span class="c1">#   may end up being sent first unless next() is called</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_find_responses</span><span class="p">(</span><span class="n">transfer_syntax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Association.send_c_get"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_c_get">[docs]</a>    <span class="k">def</span> <span class="nf">send_c_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">query_model</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a C-GET request to the peer AE.</span>

<span class="sd">        Yields ``(status, identifier)`` pairs.</span>

<span class="sd">        A :py:meth:`handler &lt;pynetdicom._handlers.doc_handle_store&gt;`</span>
<span class="sd">        should be implemented and bound to ``evt.EVT_C_STORE``</span>
<span class="sd">        prior to calling ``send_c_get`` as the peer will return any matches</span>
<span class="sd">        via a C-STORE sub-operation over the current association. In addition,</span>
<span class="sd">        SCP/SCU Role Selection Negotiation must be supported by the</span>
<span class="sd">        Association.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset</span>
<span class="sd">            The C-GET request&#39;s *Identifier* ``Dataset``. The exact</span>
<span class="sd">            requirements for the *Identifier* are Service Class specific (see</span>
<span class="sd">            the DICOM Standard, Part 4).</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The DIMSE *Message ID*, must be between 0 and 65535, inclusive,</span>
<span class="sd">            (default 1).</span>
<span class="sd">        priority : int, optional</span>
<span class="sd">            The C-GET operation *Priority* (may not be supported by the peer),</span>
<span class="sd">            one of:</span>

<span class="sd">            - ``0`` - Medium</span>
<span class="sd">            - ``1`` - High</span>
<span class="sd">            - ``2`` - Low (default)</span>

<span class="sd">        query_model : str, optional</span>
<span class="sd">            The Query/Retrieve Information Model to use, one of the following:</span>

<span class="sd">            - ``P`` - 1.2.840.10008.5.1.4.1.2.1.3 -</span>
<span class="sd">              *Patient Root Information Model - GET* (default)</span>
<span class="sd">            - ``S`` - 1.2.840.10008.5.1.4.1.2.2.3 -</span>
<span class="sd">              *Study Root Information Model - GET*</span>
<span class="sd">            - ``O`` - 1.2.840.10008.5.1.4.1.2.3.3 -</span>
<span class="sd">              *Patient Study Only Information Model - GET*</span>
<span class="sd">            - ``C`` - 1.2.840.10008.5.1.4.1.2.4.3 -</span>
<span class="sd">              *Composite Instance Root Retrieve - GET*</span>
<span class="sd">            - ``CB`` - 1.2.840.10008.5.1.4.1.2.5.3 -</span>
<span class="sd">              *Composite Instance Retrieve Without Bulk Data - GET*</span>
<span class="sd">            - ``H`` - 1.2.840.10008.5.1.4.38.4 -</span>
<span class="sd">              *Hanging Protocol Information Model - GET*</span>
<span class="sd">            - ``D`` - 1.2.840.10008.5.1.4.20.3 -</span>
<span class="sd">              *Defined Procedure  Protocol Information Model - GET*</span>
<span class="sd">            - ``CP`` - 1.2.840.10008.5.1.4.39.4 -</span>
<span class="sd">              *Palette Color Information Model - GET*</span>
<span class="sd">            - ``IG`` - 1.2.840.10008.5.1.4.43.4 -</span>
<span class="sd">              *Generic Implant Template Information Model - GET*</span>
<span class="sd">            - ``IA`` - 1.2.840.10008.5.1.4.44.4 -</span>
<span class="sd">              *Implant Assembly Template Information Model - GET*</span>
<span class="sd">            - ``IT`` - 1.2.840.10008.5.1.4.44.4 -</span>
<span class="sd">              *Implant Template Group Information Model - GET*</span>
<span class="sd">            - ``PA`` - 1.2.840.10008.5.1.4.1.1.200.6 -</span>
<span class="sd">              *Protocol Approval Information Model - GET*</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            yields an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then yields a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value may</span>
<span class="sd">            optionally contain additional elements (see DICOM Standard Part 7,</span>
<span class="sd">            Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            The status for the requested C-GET operation should be one of the</span>
<span class="sd">            following values, but as the value depends on the peer this</span>
<span class="sd">            can&#39;t be assumed:</span>

<span class="sd">            *General C-GET* (DICOM Standard Part 7, Section 9.1.3 and Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Sub-operations complete: no failures or warnings</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>

<span class="sd">            *Query/Retrieve Service, Hanging Protocol Query/Retrieve Service,</span>
<span class="sd">            Defined Procedure Protocol Query/Retrieve Service, Color Palette</span>
<span class="sd">            Query/Retrieve Service*, *Implant Template Query/Retrieve</span>
<span class="sd">            Service* and *Protocol Approval Query/Retrieve Service* specific</span>
<span class="sd">            (DICOM Standard Part 4, Annexes C.4.3,</span>
<span class="sd">            Y.C.4.2.1.4, Z.4.2.1.4, U.4.3, X, BB, HH and II):</span>

<span class="sd">            Pending</span>
<span class="sd">              | ``0xFF00`` - Sub-operations are continuing</span>

<span class="sd">            Cancel</span>
<span class="sd">              | ``0xFE00`` - Sub-operations terminated due to Cancel indication</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA701`` - Out of resources: unable to calculate number of</span>
<span class="sd">                 matches</span>
<span class="sd">              | ``0xA702`` - Out of resources: unable to perform sub-operations</span>
<span class="sd">              | ``0xA900`` - Identifier does not match SOP class</span>
<span class="sd">              | ``0xAA00`` - None of the frames requested were found in the SOP</span>
<span class="sd">                instance</span>
<span class="sd">              | ``0xAA01`` - Unable to create new object for this SOP class</span>
<span class="sd">              | ``0xAA02`` - Unable to extract frames</span>
<span class="sd">              | ``0xAA03`` - Time-based request received for a non-time-based</span>
<span class="sd">                original SOP Instance</span>
<span class="sd">              | ``0xAA04`` - Invalid request</span>
<span class="sd">              | ``0xC000`` to ``0xCFFF`` - Unable to process</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0xB000`` - Sub-operations completed: one or more failures or</span>
<span class="sd">                 warnings</span>

<span class="sd">        identifier : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Pending&#39; or &#39;Success&#39; then yields</span>
<span class="sd">            ``None``. If the status category is &#39;Warning&#39;, &#39;Failure&#39; or</span>
<span class="sd">            &#39;Cancel&#39; then yields a ``Dataset`` which should contain an</span>
<span class="sd">            (0008,0058) *Failed SOP Instance UID List* element, however this</span>
<span class="sd">            is not guaranteed and may instead be an empty ``Dataset``.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If ``send_c_get`` is called with no established association.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If no accepted Presentation Context for `dataset` exists or if</span>
<span class="sd">            unable to encode the *Identifier* `dataset`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        service_class.QueryRetrieveGetServiceClass</span>
<span class="sd">        service_class.HangingProtocolQueryRetrieveServiceClass</span>
<span class="sd">        service_class.DefinedProcedureProtocolQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ColorPaletteQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ImplantTemplateQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ProtocolApprovalQueryRetrieveServiceClass</span>
<span class="sd">        dimse_primitives.C_GET</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standard Part 4, `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_C&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex U &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_U&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex X &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_X&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex Y &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_Y&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex Z &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_Z&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex BB &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_BB&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex HH &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_HH&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex II &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_II&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `9.1.3 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.1.3&gt;`_,</span>
<span class="sd">          `9.3.3 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.3.3&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send a C-GET without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The association with a peer SCP must be &quot;</span>
                               <span class="s2">&quot;established before sending a C-GET request&quot;</span><span class="p">)</span>

        <span class="n">_sop_classes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;P&quot;</span> <span class="p">:</span> <span class="n">PatientRootQueryRetrieveInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;S&quot;</span> <span class="p">:</span> <span class="n">StudyRootQueryRetrieveInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;O&quot;</span> <span class="p">:</span> <span class="n">PatientStudyOnlyQueryRetrieveInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;C&quot;</span> <span class="p">:</span> <span class="n">CompositeInstanceRootRetrieveGet</span><span class="p">,</span>
            <span class="s2">&quot;CB&quot;</span> <span class="p">:</span> <span class="n">CompositeInstanceRetrieveWithoutBulkDataGet</span><span class="p">,</span>
            <span class="s2">&quot;H&quot;</span> <span class="p">:</span> <span class="n">HangingProtocolInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;D&quot;</span> <span class="p">:</span> <span class="n">DefinedProcedureProtocolInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;CP&quot;</span> <span class="p">:</span> <span class="n">ColorPaletteInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;IG&quot;</span> <span class="p">:</span> <span class="n">GenericImplantTemplateInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;IA&quot;</span> <span class="p">:</span> <span class="n">ImplantAssemblyTemplateInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;IT&quot;</span> <span class="p">:</span> <span class="n">ImplantTemplateGroupInformationModelGet</span><span class="p">,</span>
            <span class="s2">&quot;PA&quot;</span> <span class="p">:</span> <span class="n">ProtocolApprovalInformationModelGet</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sop_class</span> <span class="o">=</span> <span class="n">_sop_classes</span><span class="p">[</span><span class="n">query_model</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported value for `query_model`: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query_model</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">sop_class</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>

        <span class="c1"># Build C-GET request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="c1">#   (M) Priority</span>
        <span class="c1">#   (M) Identifier</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">C_GET</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">sop_class</span>
        <span class="n">req</span><span class="o">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="n">priority</span>

        <span class="c1"># Encode the Identifier `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">Identifier</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to encode the supplied Identifier dataset&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Failed to encode the supplied Identifer &#39;</span>
                             <span class="s1">&#39;dataset&#39;</span><span class="p">)</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Get Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;# Identifier DICOM Dataset&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Send C-GET request to the peer via DIMSE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>

        <span class="c1"># Get the responses from the peer</span>
        <span class="c1"># Wrap the generator so the C-GET-RQ is sent immediately on</span>
        <span class="c1">#   executing this function, otherwise sending C-CANCEL requests</span>
        <span class="c1">#   may end up being sent first unless next() is called</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_get_move_responses</span><span class="p">(</span><span class="n">transfer_syntax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Association.send_c_move"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_c_move">[docs]</a>    <span class="k">def</span> <span class="nf">send_c_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">move_aet</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">query_model</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a C-MOVE request to the peer AE.</span>

<span class="sd">        Yields ``(status, identifier)`` pairs.</span>

<span class="sd">        The peer will attempt to start a new association with the AE with</span>
<span class="sd">        *AE Title* ``move_aet`` and hence must be known to the SCP. Once the</span>
<span class="sd">        association has been established it will use the C-STORE service to</span>
<span class="sd">        send any matching datasets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset</span>
<span class="sd">            The C-MOVE request&#39;s *Identifier* ``Dataset``. The exact</span>
<span class="sd">            requirements for the *Identifier* are Service Class specific (see</span>
<span class="sd">            the DICOM Standard, Part 4).</span>
<span class="sd">        move_aet : bytes</span>
<span class="sd">            The value of the *Move Destination* parameter for the C-MOVE</span>
<span class="sd">            request, should be the AE title of the Storage SCP for the</span>
<span class="sd">            C-STORE sub-operations performed by the peer.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The DIMSE *Message ID*, must be between 0 and 65535, inclusive,</span>
<span class="sd">            (default 1).</span>
<span class="sd">        priority : int, optional</span>
<span class="sd">            The value of the *Priority* parameter (if supported by the peer),</span>
<span class="sd">            one of:</span>

<span class="sd">            - ``0`` - Medium</span>
<span class="sd">            - ``1`` - High</span>
<span class="sd">            - ``2`` - Low (default)</span>

<span class="sd">        query_model : str, optional</span>
<span class="sd">            The Query/Retrieve Information Model to use, one of the following:</span>

<span class="sd">            - ``P`` - 1.2.840.10008.5.1.4.1.2.1.2 -</span>
<span class="sd">              *Patient Root Information Model - MOVE* (default)</span>
<span class="sd">            - ``S`` - 1.2.840.10008.5.1.4.1.2.2.2 -</span>
<span class="sd">              *Study Root Information Model - MOVE*</span>
<span class="sd">            - ``O`` - 1.2.840.10008.5.1.4.1.2.3.2 -</span>
<span class="sd">              *Patient Study Only Information Model - MOVE*</span>
<span class="sd">            - ``C`` - 1.2.840.10008.5.1.4.1.2.4.2 -</span>
<span class="sd">              *Composite Instance Root Retrieve - MOVE*</span>
<span class="sd">            - ``H`` - 1.2.840.10008.5.1.4.38.3 -</span>
<span class="sd">              *Hanging Protocol Information Model - MOVE*</span>
<span class="sd">            - ``D`` - 1.2.840.10008.5.1.4.20.2 -</span>
<span class="sd">              *Defined Procedure Protocol Information Model - MOVE*</span>
<span class="sd">            - ``CP`` - 1.2.840.10008.5.1.4.39.3 -</span>
<span class="sd">              *Color Palette Information Model - MOVE*</span>
<span class="sd">            - ``IG`` - 1.2.840.10008.5.1.4.43.3 -</span>
<span class="sd">              *Generic Implant Template Information Model - MOVE*</span>
<span class="sd">            - ``IA`` - 1.2.840.10008.5.1.4.44.3 -</span>
<span class="sd">              *Implant Assembly Template Information Model - MOVE*</span>
<span class="sd">            - ``IT`` - 1.2.840.10008.5.1.4.44.3 -</span>
<span class="sd">              *Implant Template Group Information Model - MOVE*</span>
<span class="sd">            - ``PA`` - 1.2.840.10008.5.1.4.1.1.200.5 -</span>
<span class="sd">              *Protocol Approval Information Model - MOVE*</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            yields an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then yields a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see DICOM Standard Part 7,</span>
<span class="sd">            Section 9.1.4 and Annex C).</span>

<span class="sd">            The status for the requested C-MOVE operation should be one of the</span>
<span class="sd">            following values, but as the value depends</span>
<span class="sd">            on the peer this can&#39;t be assumed:</span>

<span class="sd">            *General C-MOVE* (DICOM Standard Part 7, 9.1.4.1.7 and Annex C)</span>

<span class="sd">            Cancel</span>
<span class="sd">              | ``0xFE00`` - Sub-operations terminated due to Cancel indication</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Sub-operations complete: no failures</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>

<span class="sd">            *Query/Retrieve Service, Hanging Protocol Query/Retrieve Service,</span>
<span class="sd">            Defined Procedure Protocol Query/Retrieve Service, Color Palette</span>
<span class="sd">            Query/Retrieve Service* , *Implant Template Query/Retreive</span>
<span class="sd">            Service* and *Protocol Approval Query/Retrieve Service*</span>
<span class="sd">            specific (DICOM Standard Part 4, Annexes C, U, Y, X, BB and HH):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA701`` - Out of resources: unable to calculate number of</span>
<span class="sd">                matches</span>
<span class="sd">              | ``0xA702`` - Out of resources: unable to perform sub-operations</span>
<span class="sd">              | ``0xA801`` - Move destination unknown</span>
<span class="sd">              | ``0xA900`` - Identifier does not match SOP Class</span>
<span class="sd">              | ``0xAA00`` - None of the frames requested were found in the SOP</span>
<span class="sd">                instance</span>
<span class="sd">              | ``0xAA01`` - Unable to create new object for this SOP class</span>
<span class="sd">              | ``0xAA02`` - Unable to extract frames</span>
<span class="sd">              | ``0xAA03`` - Time-based request received for a non-time-based</span>
<span class="sd">                original SOP Instance</span>
<span class="sd">              | ``0xAA04`` - Invalid request</span>
<span class="sd">              | ``0xC000`` to ``0xCFFF`` - Unable to process</span>

<span class="sd">            Pending</span>
<span class="sd">              | ``0xFF00`` - Sub-operations are continuing</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0xB000`` - Sub-operations complete: one or more failures</span>

<span class="sd">        identifier : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Pending&#39; or &#39;Success&#39; then yields</span>
<span class="sd">            ``None``. If the status category is &#39;Warning&#39;, &#39;Failure&#39; or</span>
<span class="sd">            &#39;Cancel&#39; then yields a ``Dataset`` which should contain an</span>
<span class="sd">            (0008,0058) *Failed SOP Instance UID List* element, however this</span>
<span class="sd">            is not guaranteed and may instead be an empty ``Dataset``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.C_MOVE</span>
<span class="sd">        service_class.QueryRetrieveMoveServiceClass</span>
<span class="sd">        service_class.HangingProtocolQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ColorPaletteQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ImplantTemplateQueryRetrieveServiceClass</span>
<span class="sd">        service_class.ProtocolApprovalQueryRetrieveServiceClass</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standard Part 4, `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_C&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex U &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_U&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex X &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_X&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex Y &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_Y&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex BB &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_BB&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex HH &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_HH&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex II &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_II&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `9.1.4 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.1.4&gt;`_,</span>
<span class="sd">          `9.3.4 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.3.4&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send a C-MOVE without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The association with a peer SCP must be &quot;</span>
                               <span class="s2">&quot;established before sending a C-MOVE request&quot;</span><span class="p">)</span>

        <span class="n">_sop_classes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;P&quot;</span> <span class="p">:</span> <span class="n">PatientRootQueryRetrieveInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;S&quot;</span> <span class="p">:</span> <span class="n">StudyRootQueryRetrieveInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;O&quot;</span> <span class="p">:</span> <span class="n">PatientStudyOnlyQueryRetrieveInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;C&quot;</span> <span class="p">:</span> <span class="n">CompositeInstanceRootRetrieveMove</span><span class="p">,</span>
            <span class="s2">&quot;H&quot;</span> <span class="p">:</span> <span class="n">HangingProtocolInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;D&quot;</span> <span class="p">:</span> <span class="n">DefinedProcedureProtocolInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;CP&quot;</span> <span class="p">:</span> <span class="n">ColorPaletteInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;IG&quot;</span> <span class="p">:</span> <span class="n">GenericImplantTemplateInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;IA&quot;</span> <span class="p">:</span> <span class="n">ImplantAssemblyTemplateInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;IT&quot;</span> <span class="p">:</span> <span class="n">ImplantTemplateGroupInformationModelMove</span><span class="p">,</span>
            <span class="s2">&quot;PA&quot;</span> <span class="p">:</span> <span class="n">ProtocolApprovalInformationModelMove</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sop_class</span> <span class="o">=</span> <span class="n">_sop_classes</span><span class="p">[</span><span class="n">query_model</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported value for `query_model`: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query_model</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">sop_class</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>

        <span class="c1"># Build C-MOVE request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="c1">#   (M) Priority</span>
        <span class="c1">#   (M) Move Destination</span>
        <span class="c1">#   (M) Identifier</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">C_MOVE</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">sop_class</span>
        <span class="n">req</span><span class="o">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="n">priority</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MoveDestination</span> <span class="o">=</span> <span class="n">move_aet</span>

        <span class="c1"># Encode the Identifier `dataset` using the agreed transfer syntax;</span>
        <span class="c1">#   will return None if failed to encode</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">Identifier</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Failed to encode the supplied Identifier dataset&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Failed to encode the supplied Identifier &#39;</span>
                             <span class="s1">&#39;dataset&#39;</span><span class="p">)</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Move Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;# Identifier DICOM Dataset&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Send C-MOVE request to the peer via DIMSE and wait for the response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>

        <span class="c1"># Get the responses from the peer</span>
        <span class="c1"># Wrap the generator so the C-MOVE-RQ is sent immediately on</span>
        <span class="c1">#   executing this function, otherwise sending C-CANCEL requests</span>
        <span class="c1">#   may end up being sent first unless next() is called</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_get_move_responses</span><span class="p">(</span><span class="n">transfer_syntax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Association.send_c_store"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_c_store">[docs]</a>    <span class="k">def</span> <span class="nf">send_c_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">originator_aet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">originator_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a C-STORE request to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset</span>
<span class="sd">            The DICOM dataset to send to the peer.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The DIMSE *Message ID*, must be between 0 and 65535, inclusive,</span>
<span class="sd">            (default ``1``).</span>
<span class="sd">        priority : int, optional</span>
<span class="sd">            The C-STORE operation *Priority* (may not be supported by the</span>
<span class="sd">            peer), one of:</span>

<span class="sd">            - ``0`` - Medium</span>
<span class="sd">            - ``1`` - High</span>
<span class="sd">            - ``2`` - Low (default)</span>
<span class="sd">        originator_aet : bytes, optional</span>
<span class="sd">            The value of the *Move Originator Application Entity Title*</span>
<span class="sd">            parameter for the C-STORE request. This is the AE title of the</span>
<span class="sd">            peer that invoked the C-MOVE operation for</span>
<span class="sd">            which this C-STORE sub-operation is being performed (default</span>
<span class="sd">            ``None``).</span>
<span class="sd">        originator_id : int, optional</span>
<span class="sd">            The value of the *Move Originator Message ID* parameter for the</span>
<span class="sd">            C-STORE request. This is the original *Message ID* parameter value</span>
<span class="sd">            for the C-MOVE request primitive for which the</span>
<span class="sd">            C-STORE sub-operation is being performed (default ``None``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a valid response was received</span>
<span class="sd">            from the peer then returns a ``Dataset`` containing at least a</span>
<span class="sd">            (0000,0900) *Status* element, and, depending on the returned</span>
<span class="sd">            value, may optionally contain additional elements (see DICOM</span>
<span class="sd">            Standard Part 7, Annex C).</span>

<span class="sd">            The status for the requested C-STORE operation should be one of the</span>
<span class="sd">            following, but as the value depends on the peer SCP this can&#39;t be</span>
<span class="sd">            assumed:</span>

<span class="sd">            *General C-STORE* (DICOM Standard Part 7, 9.1.1.1.9 and Annex C):</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Success</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0117`` - Invalid SOP instance</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>

<span class="sd">            *Storage Service* and *Non-Patient Object Storage Service* specific</span>
<span class="sd">            (DICOM Standard Part 4, Annexes B.2.3 and GG):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA700`` to ``0xA7FF`` - Out of resources</span>
<span class="sd">              | ``0xA900`` to ``0xA9FF`` - Data set does not match SOP class</span>
<span class="sd">              | ``0xC000`` to ``0xCFFF`` - Cannot understand</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0xB000`` - Coercion of data elements</span>
<span class="sd">              | ``0xB006`` - Element discarded</span>
<span class="sd">              | ``0xB007`` - Data set does not match SOP class</span>

<span class="sd">            *Non-Patient Object Service Class* specific (DICOM Standard Part 4,</span>
<span class="sd">            Annex GG.4.2)</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA700`` - Out of resources</span>
<span class="sd">              | ``0xA900`` - Data set does not match SOP class</span>
<span class="sd">              | ``0xC000`` - Cannot understand</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If ``send_c_store`` is called with no established association.</span>
<span class="sd">        AttributeError</span>
<span class="sd">            If `dataset` is missing (0008,0016) *SOP Class UID*,</span>
<span class="sd">            (0008,0018) *SOP Instance UID* elements or the (0002,0010)</span>
<span class="sd">            *Transfer Syntax UID* file meta information element.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If no accepted Presentation Context for `dataset` exists or if</span>
<span class="sd">            unable to encode the `dataset`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.C_STORE</span>
<span class="sd">        service_class.StorageServiceClass</span>
<span class="sd">        service_class.NonPatientObjectStorageServiceClass</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standard Part 4, Annex `B &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_B&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, Annex `GG &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_GG&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `9.1.1 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.1.1&gt;`_,</span>
<span class="sd">          `9.3.1 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_9.3.1&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send a C-STORE without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The association with a peer SCP must be &quot;</span>
                               <span class="s2">&quot;established before sending a C-STORE request&quot;</span><span class="p">)</span>

        <span class="c1"># Check `dataset` has required elements</span>
        <span class="k">if</span> <span class="s1">&#39;SOPClassUID&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to determine the presentation context to use with &quot;</span>
                <span class="s2">&quot;`dataset` as it contains no &#39;(0008,0016) SOP Class UID&#39; &quot;</span>
                <span class="s2">&quot;element&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s1">&#39;TransferSyntaxUID&#39;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">file_meta</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to determine the presentation context to use with &quot;</span>
                <span class="s2">&quot;`dataset` as it contains no &#39;(0002,0010) Transfer Syntax &quot;</span>
                <span class="s2">&quot;UID&#39; file meta information element&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get a Presentation Context to use for sending the message</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">SOPClassUID</span><span class="p">,</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span><span class="p">,</span>
            <span class="s1">&#39;scu&#39;</span>
        <span class="p">)</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Build C-STORE request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="c1">#   (M) Affected SOP Instance UID</span>
        <span class="c1">#   (M) Priority</span>
        <span class="c1">#   (U) Move Originator Application Entity Title</span>
        <span class="c1">#   (U) Move Originator Message ID</span>
        <span class="c1">#   (M) Data Set</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">C_STORE</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">SOPClassUID</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPInstanceUID</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">SOPInstanceUID</span>
        <span class="n">req</span><span class="o">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="n">priority</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MoveOriginatorApplicationEntityTitle</span> <span class="o">=</span> <span class="n">originator_aet</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MoveOriginatorMessageID</span> <span class="o">=</span> <span class="n">originator_id</span>

        <span class="c1"># Encode the `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">DataSet</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to encode the supplied Dataset&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Failed to encode the supplied Dataset&#39;</span><span class="p">)</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Send C-STORE request to the peer via DIMSE and wait for the response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">()</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span></div>

    <span class="k">def</span> <span class="nf">_wrap_find_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_syntax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for the C-FIND response generator.</span>

<span class="sd">        Wrapping the response generators allows us to immediately send the</span>
<span class="sd">        service request on calling the ``send_c_find()`` function. This is</span>
<span class="sd">        important when it comes to reliably sending C-CANCEL requests</span>
<span class="sd">        because otherwise the C-CANCEL may end up being sent prior to the</span>
<span class="sd">        C-FIND request.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        transfer_syntax : pydicom.uid.UID</span>
<span class="sd">            The transfer syntax UID used to encode the responses.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        See ``send_c_find()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation_no</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Wait for DIMSE message</span>
            <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># If `rsp` is None then the DIMSE timeout expired</span>
            <span class="c1">#   so abort if the association hasn&#39;t already been aborted</span>
            <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">C_FIND</span><span class="p">):</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Received an unexpected </span><span class="si">{}</span><span class="s1"> message from the peer&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">rsp</span><span class="o">.</span><span class="n">is_valid_response</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Received an invalid C-FIND response from the peer&#39;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Status may be &#39;Failure&#39;, &#39;Cancel&#39;, &#39;Warning&#39;, &#39;Success&#39;</span>
            <span class="c1">#   or &#39;Pending&#39;</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">()</span>
            <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span>
            <span class="c1"># Add optional status related elements</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">rsp</span><span class="o">.</span><span class="n">STATUS_OPTIONAL_KEYWORDS</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">keyword</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">keyword</span><span class="p">))</span>

            <span class="c1"># If the Status is &#39;Pending&#39; then the processing of</span>
            <span class="c1">#   matches and sub-operations is initiated or continuing</span>
            <span class="c1"># If the Status is &#39;Cancel&#39;, &#39;Failure&#39;, &#39;Warning&#39; or &#39;Success&#39;</span>
            <span class="c1">#   then we are finished</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>

            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">STATUS_PENDING</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Find SCP Response: </span><span class="si">{}</span><span class="s2"> - 0x</span><span class="si">{:04x}</span><span class="s2"> (Pending)&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operation_no</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Find SCP Result: 0x</span><span class="si">{:04x}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># &#39;Success&#39;, &#39;Warning&#39;, &#39;Failure&#39;, &#39;Cancel&#39; are final yields,</span>
            <span class="c1">#   &#39;Pending&#39; means more to come</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_PENDING</span><span class="p">]:</span>
                <span class="n">operation_no</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">Identifier</span><span class="p">,</span>
                                        <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                        <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;# Identifier DICOM Dataset&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to decode the received Identifier dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="k">yield</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

                <span class="k">yield</span> <span class="n">status</span><span class="p">,</span> <span class="n">identifier</span>
                <span class="k">continue</span>

            <span class="c1"># Only reach this point if status is Sucess, Warning, Failure</span>
            <span class="c1">#   or Cancel</span>
            <span class="k">yield</span> <span class="n">status</span><span class="p">,</span> <span class="n">identifier</span>
            <span class="k">break</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_wrap_get_move_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_syntax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for the C-GET/C-MOVE response generators.</span>

<span class="sd">        Wrapping the response generators allows us to immediately send the</span>
<span class="sd">        service request on calling the respective ``send_c_*()`` function.</span>
<span class="sd">        This is important when it comes to reliably sending C-CANCEL requests</span>
<span class="sd">        because otherwise the C-CANCEL may end up being sent prior to the</span>
<span class="sd">        C-GET/MOVE request.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        transfer_syntax : pydicom.uid.UID</span>
<span class="sd">            The transfer syntax UID used to encode the responses.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        See ``send_c_get()`` and ``send_c_move()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation_no</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Wait for DIMSE message, should be either a C-GET or</span>
            <span class="c1">#   C-MOVE response or a C-STORE request</span>
            <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Used to describe the response in the log output</span>
            <span class="n">rsp_type</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">rsp_name</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C-GET&#39;</span> <span class="p">:</span> <span class="s1">&#39;Get&#39;</span><span class="p">,</span> <span class="s1">&#39;C-MOVE&#39;</span> <span class="p">:</span> <span class="s1">&#39;Move&#39;</span><span class="p">}</span>

            <span class="c1"># If `rsp` is None then the DIMSE timeout expired</span>
            <span class="c1">#   so abort if the association hasn&#39;t already been aborted</span>
            <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="p">(</span><span class="n">C_STORE</span><span class="p">,</span> <span class="n">C_GET</span><span class="p">,</span> <span class="n">C_MOVE</span><span class="p">)):</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Received an unexpected </span><span class="si">{}</span><span class="s1"> message from the peer&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rsp_type</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">C_STORE</span><span class="p">):</span>
                <span class="c1"># Received a C-STORE request from the peer</span>
                <span class="c1"># Should occur during C-GET and may occur during C-MOVE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_c_store_scp</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">rsp</span><span class="o">.</span><span class="n">is_valid_response</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Received an invalid </span><span class="si">{}</span><span class="s1"> response from the peer&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rsp_type</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Status may be &#39;Failure&#39;, &#39;Cancel&#39;, &#39;Warning&#39;, &#39;Success&#39;</span>
            <span class="c1">#   or &#39;Pending&#39;</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">()</span>
            <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">Status</span>
            <span class="c1"># Add optional status related elements</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">rsp</span><span class="o">.</span><span class="n">STATUS_OPTIONAL_KEYWORDS</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">keyword</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">keyword</span><span class="p">))</span>

            <span class="c1"># If the Status is &#39;Pending&#39; then the processing of</span>
            <span class="c1">#   matches and sub-operations is initiated or continuing</span>
            <span class="c1"># If the Status is &#39;Cancel&#39;, &#39;Failure&#39;, &#39;Warning&#39; or &#39;Success&#39;</span>
            <span class="c1">#   then we are finished</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>

            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">STATUS_PENDING</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SCP Response: </span><span class="si">{}</span><span class="s2"> - 0x</span><span class="si">{:04x}</span><span class="s2"> (Pending)&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rsp_name</span><span class="p">[</span><span class="n">rsp_type</span><span class="p">],</span> <span class="n">operation_no</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> SCP Result: 0x</span><span class="si">{:04x}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rsp_name</span><span class="p">[</span><span class="n">rsp_type</span><span class="p">],</span> <span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># Log number of remaining sub-operations - C-GET/C-MOVE only</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Sub-Operations Remaining: </span><span class="si">%s</span><span class="s2">, Completed: </span><span class="si">%s</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;Failed: </span><span class="si">%s</span><span class="s2">, Warning: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">rsp</span><span class="o">.</span><span class="n">NumberOfRemainingSuboperations</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                <span class="n">rsp</span><span class="o">.</span><span class="n">NumberOfCompletedSuboperations</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                <span class="n">rsp</span><span class="o">.</span><span class="n">NumberOfFailedSuboperations</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                <span class="n">rsp</span><span class="o">.</span><span class="n">NumberOfWarningSuboperations</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span>
            <span class="p">)</span>

            <span class="c1"># &#39;Success&#39;, &#39;Warning&#39;, &#39;Failure&#39;, &#39;Cancel&#39; are final yields,</span>
            <span class="c1">#   &#39;Pending&#39; means more to come</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_PENDING</span><span class="p">]:</span>
                <span class="n">operation_no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">status</span><span class="p">,</span> <span class="n">identifier</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">Identifier</span> <span class="ow">and</span> <span class="n">category</span> <span class="ow">in</span>
                    <span class="p">[</span><span class="n">STATUS_CANCEL</span><span class="p">,</span> <span class="n">STATUS_WARNING</span><span class="p">,</span> <span class="n">STATUS_FAILURE</span><span class="p">]):</span>
                <span class="c1"># From Part 4, Annex C.4.3, responses with these</span>
                <span class="c1">#   statuses should contain an Identifier dataset</span>
                <span class="c1">#   with a (0008,0058) Failed SOP Instance UID List</span>
                <span class="c1">#    element however this can&#39;t be assumed</span>
                <span class="c1"># pylint: disable=broad-except</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">Identifier</span><span class="p">,</span>
                                        <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                        <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">identifier</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;# Identifier DICOM Dataset&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
                            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to decode the received Identifier dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Only reach this point if status is Sucess, Warning, Failure</span>
            <span class="c1">#   or Cancel</span>
            <span class="k">yield</span> <span class="n">status</span><span class="p">,</span> <span class="n">identifier</span>
            <span class="k">break</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="c1"># DIMSE-N services provided by the Association</span>
<div class="viewcode-block" id="Association.send_n_action"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_n_action">[docs]</a>    <span class="k">def</span> <span class="nf">send_n_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">action_type</span><span class="p">,</span> <span class="n">class_uid</span><span class="p">,</span> <span class="n">instance_uid</span><span class="p">,</span>
                      <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an N-ACTION request message to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset or None</span>
<span class="sd">            The dataset that will be sent as the *Action Information*</span>
<span class="sd">            parameter in the N-ACTION request, or ``None`` if not required.</span>
<span class="sd">        action_type : int</span>
<span class="sd">            The value of the request&#39;s (0000,1008) *Action Type ID* parameter.</span>
<span class="sd">        class_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,0003) *Requested SOP</span>
<span class="sd">            Class UID* parameter.</span>
<span class="sd">        instance_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,1001) *Requested SOP</span>
<span class="sd">            Instance UID* parameter.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The request&#39;s *Message ID* parameter value, must be between 0 and</span>
<span class="sd">            65535, inclusive, (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then returns a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            *General N-ACTION* (DICOM Standard Part 7, Section 10.1.4 and</span>
<span class="sd">            Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Successful operation</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0110`` - Processing failure</span>
<span class="sd">              | ``0x0112`` - No such SOP Instance</span>
<span class="sd">              | ``0x0114`` - No such argument</span>
<span class="sd">              | ``0x0115`` - Invalid argument value</span>
<span class="sd">              | ``0x0117`` - Invalid object instance</span>
<span class="sd">              | ``0x0118`` - No such SOP Class</span>
<span class="sd">              | ``0x0119`` - Class-Instance conflict</span>
<span class="sd">              | ``0x0123`` - No such action</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>
<span class="sd">              | ``0x0213`` - Resource limitation</span>

<span class="sd">        action_reply : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Success&#39; then a ``Dataset``</span>
<span class="sd">            containing attributes corresponding to those supplied in the</span>
<span class="sd">            *Action Reply*, otherwise returns ``None``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.N_ACTION</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standart Part 4, `Annex F &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_F&gt;`_</span>
<span class="sd">        * DICOM Standart Part 4, `Annex H &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_H&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex CC &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_CC&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex DD &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_DD&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `10.1.3 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.1.3&gt;`_,</span>
<span class="sd">          `10.3.3 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.3.3&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send an N-ACTION without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be established prior &quot;</span>
                <span class="s2">&quot;to sending an N-ACTION request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">class_uid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Build N-ACTION request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Requested SOP Class UID</span>
        <span class="c1">#   (M) Requested SOP Instance UID</span>
        <span class="c1">#   (M) Action Type ID</span>
        <span class="c1">#   (U) Action Information</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">N_ACTION</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPClassUID</span> <span class="o">=</span> <span class="n">class_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPInstanceUID</span> <span class="o">=</span> <span class="n">instance_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">ActionTypeID</span> <span class="o">=</span> <span class="n">action_type</span>

        <span class="c1"># Encode the `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">ActionInformation</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to encode the supplied &#39;Action Information&#39; dataset&quot;</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Send N-ACTION request to the peer via DIMSE and wait for the response</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Action Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="c1"># Warning and Success statuses will return a dataset</span>
        <span class="c1">#   we check against None as 0x0000 is a possible status</span>
        <span class="n">action_reply</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_WARNING</span><span class="p">,</span> <span class="n">STATUS_SUCCESS</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">action_reply</span>

            <span class="n">bytestream</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">ActionReply</span>
            <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">and</span> <span class="n">bytestream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="c1"># Attempt to decode the response&#39;s dataset</span>
                <span class="c1"># pylint: disable=broad-except</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">action_reply</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">bytestream</span><span class="p">,</span>
                                          <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                          <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to decode the received &#39;Action Reply&#39; dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="c1"># Failure: Processing failure</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0x0110</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">action_reply</span></div>

<div class="viewcode-block" id="Association.send_n_create"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_n_create">[docs]</a>    <span class="k">def</span> <span class="nf">send_n_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">class_uid</span><span class="p">,</span> <span class="n">instance_uid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an N-CREATE request message to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset or None</span>
<span class="sd">            The dataset that will be sent as the *Attribute List*</span>
<span class="sd">            parameter in the N-CREATE request, or ``None`` if not required.</span>
<span class="sd">        class_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,0002) *Affected SOP</span>
<span class="sd">            Class UID* parameter.</span>
<span class="sd">        instance_uid : pydicom.uid.UID, optional</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,1000) *Affected SOP</span>
<span class="sd">            Instance UID* parameter.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The request&#39;s *Message ID* parameter value, must be between 0 and</span>
<span class="sd">            65535, inclusive, (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then returns a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            *General N-CREATE* (DICOM Standard Part 7, Section 10.1.5 and</span>
<span class="sd">            Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Successful operation</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0110`` - Processing failure</span>
<span class="sd">              | ``0x0112`` - No such SOP Instance</span>
<span class="sd">              | ``0x0114`` - No such argument</span>
<span class="sd">              | ``0x0115`` - Invalid argument value</span>
<span class="sd">              | ``0x0117`` - Invalid object instance</span>
<span class="sd">              | ``0x0118`` - No such SOP Class</span>
<span class="sd">              | ``0x0119`` - Class-Instance conflict</span>
<span class="sd">              | ``0x0123`` - No such action</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>
<span class="sd">              | ``0x0213`` - Resource limitation</span>

<span class="sd">            *Print Management Service* specific (DICOM</span>
<span class="sd">            Standard Part 4, Annex H.4.1.2.1.2, H.4.2.2.1.2 and H.4.9.2.1.2):</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0xB600`` - Memory allocation not supported</span>
<span class="sd">              | ``0xB605`` - Requested Min Density or Max Density outside of</span>
<span class="sd">                printer&#39;s operating range. The printer will use its respective</span>
<span class="sd">                minimum or maximum density value instead</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC616`` - There is an existing Film Box that has not been</span>
<span class="sd">                printed and N-ACTION at the Film Session level is not supported.</span>
<span class="sd">                A new Film Box will not be created when a previous Film Box has</span>
<span class="sd">                not been printed</span>

<span class="sd">            *Media Creation Management Service* specific (DICOM</span>
<span class="sd">            Standard Part 4, Annex S.3.2.1.4):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xA510`` - Failed: an initiate media creation action has already been</span>
<span class="sd">                received for this SOP Instance</span>

<span class="sd">            *Unified Procedure Step Service* specific (DICOM</span>
<span class="sd">            Standard Part 4, Annex CC.2.5.4):</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0xB300`` - THE UPS was created with modifications</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC309`` - The provided value of UPS State was not &#39;SCHEDULED&#39;</span>

<span class="sd">            *RT Machine Verification Service* specific (DICOM</span>
<span class="sd">            Standard Part 4, Annex DD.3.2.1.2):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC221`` - The Referenced Fraction Group Number does not exist in the</span>
<span class="sd">                referenced plan</span>
<span class="sd">              | ``0xC222`` - No beams exist within the referenced fraction group</span>
<span class="sd">              | ``0xC223`` - SCU already verifying and cannot currently process this</span>
<span class="sd">                request</span>
<span class="sd">              | ``0xC227`` - No such object instance - Referenced RT Plan not found</span>

<span class="sd">        attribute_list : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Success&#39; then a ``Dataset`` containing</span>
<span class="sd">            attributes corresponding to those supplied in the *Attribute List*,</span>
<span class="sd">            otherwise returns ``None``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.N_CREATE</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standart Part 4, `Annex F &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_F&gt;`_</span>
<span class="sd">        * DICOM Standart Part 4, `Annex H &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_H&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex CC &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_CC&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex DD &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_DD&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `10.1.5 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.1.5&gt;`_,</span>
<span class="sd">          `10.3.5 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.3.5&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send an N-CREATE without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be established prior &quot;</span>
                <span class="s2">&quot;to sending an N-CREATE request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">class_uid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Build N-CREATE request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="c1">#   (U) Affected SOP Instance UID</span>
        <span class="c1">#   (U) Attribute List</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">N_CREATE</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">class_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPInstanceUID</span> <span class="o">=</span> <span class="n">instance_uid</span>

        <span class="c1"># Encode the `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">AttributeList</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to encode the supplied &#39;Attribute List&#39; dataset&quot;</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Send N-CREATE request to the peer via DIMSE and wait for the response</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Create Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="c1"># Warning and Success statuses will return a dataset</span>
        <span class="c1">#   we check against None as 0x0000 is a possible status</span>
        <span class="n">attribute_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_WARNING</span><span class="p">,</span> <span class="n">STATUS_SUCCESS</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">attribute_list</span>

            <span class="n">bytestream</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">AttributeList</span>
            <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">and</span> <span class="n">bytestream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="c1"># Attempt to decode the response&#39;s dataset</span>
                <span class="c1"># pylint: disable=broad-except</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attribute_list</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">bytestream</span><span class="p">,</span>
                                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to decode the received &#39;Attribute List&#39; &quot;</span>
                        <span class="s2">&quot;dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="c1"># Failure: Processing failure</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0x0110</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">attribute_list</span></div>

<div class="viewcode-block" id="Association.send_n_delete"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_n_delete">[docs]</a>    <span class="k">def</span> <span class="nf">send_n_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_uid</span><span class="p">,</span> <span class="n">instance_uid</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an N-DELETE request message to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        class_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,0003) *Requested SOP</span>
<span class="sd">            Class UID* parameter.</span>
<span class="sd">        instance_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,1001) *Requested SOP</span>
<span class="sd">            Instance UID* parameter.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The request&#39;s *Message ID* parameter value, must be between 0 and</span>
<span class="sd">            65535, inclusive, (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then returns a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            General N-DELETE (DICOM Standard Part 7, Section 10.1.6 and</span>
<span class="sd">            Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Successful operation</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0110`` - Processing failure</span>
<span class="sd">              | ``0x0112`` - No such SOP Instance</span>
<span class="sd">              | ``0x0117`` - Invalid object instance</span>
<span class="sd">              | ``0x0118`` - No such SOP Class</span>
<span class="sd">              | ``0x0119`` - Class-Instance conflict</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>
<span class="sd">              | ``0x0213`` - Resource limitation</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.N_DELETE</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standart Part 4, `Annex H &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_H&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex DD &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_DD&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `10.1.6 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.1.6&gt;`_,</span>
<span class="sd">          `10.3.6 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.3.6&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send an N-DELETE without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be established prior &quot;</span>
                <span class="s2">&quot;to sending an N-DELETE request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">class_uid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>

        <span class="c1"># Build N-DELETE request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Requested SOP Class UID</span>
        <span class="c1">#   (M) Requested SOP Instance UID</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">N_DELETE</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPClassUID</span> <span class="o">=</span> <span class="n">class_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPInstanceUID</span> <span class="o">=</span> <span class="n">instance_uid</span>

        <span class="c1"># Send N-DELETE request to the peer via DIMSE and wait for the response</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Delete Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">()</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="Association.send_n_event_report"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_n_event_report">[docs]</a>    <span class="k">def</span> <span class="nf">send_n_event_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">class_uid</span><span class="p">,</span>
                            <span class="n">instance_uid</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an N-EVENT-REPORT request message to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset or None</span>
<span class="sd">            The dataset that will be sent as the *Event Information* parameter</span>
<span class="sd">            in the N-EVENT-REPORT request, if no *Event Information* parameter</span>
<span class="sd">            is needed then ``None``.</span>
<span class="sd">        event_type : int</span>
<span class="sd">            The value to be sent for the request&#39;s (0000,1002) *Event Type ID*</span>
<span class="sd">            parameter.</span>
<span class="sd">        class_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,0003) *Affected SOP</span>
<span class="sd">            Class UID* parameter.</span>
<span class="sd">        instance_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,1000) *Affected SOP</span>
<span class="sd">            Instance UID* parameter.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The request&#39;s *Message ID* parameter value, must be between 0 and</span>
<span class="sd">            65535, inclusive, (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then returns a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            *General N-EVENT-REPORT* (DICOM Standard Part 7, Section 10.1.1</span>
<span class="sd">            and Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Successful operation</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0110`` - Processing failure</span>
<span class="sd">              | ``0x0112`` - No such SOP Instance</span>
<span class="sd">              | ``0x0113`` - No such event type</span>
<span class="sd">              | ``0x0114`` - No such argument</span>
<span class="sd">              | ``0x0115`` - Invalid argument value</span>
<span class="sd">              | ``0x0117`` - Invalid object instance</span>
<span class="sd">              | ``0x0118`` - No such SOP Class</span>
<span class="sd">              | ``0x0119`` - Class-Instance conflict</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>
<span class="sd">              | ``0x0213`` - Resource limitation</span>

<span class="sd">        event_reply : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Success&#39; then a ``Dataset`` containing</span>
<span class="sd">            the *Event Reply* to the event report request.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.N_EVENT_REPORT</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standart Part 4, `Annex F &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_F&gt;`_</span>
<span class="sd">        * DICOM Standart Part 4, `Annex H &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_H&gt;`_</span>
<span class="sd">        * DICOM Standart Part 4, `Annex J &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_J&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex CC &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_CC&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex DD &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_DD&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `10.1.1 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.1.1&gt;`_,</span>
<span class="sd">          `10.3.1 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.3.1&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send an N-EVENT-REPORT without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be established prior &quot;</span>
                <span class="s2">&quot;to sending an N-EVENT-REPORT request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">class_uid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>

        <span class="c1"># Build N-EVENT-REPORT request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Affected SOP Class UID</span>
        <span class="c1">#   (M) Affected SOP Instance UID</span>
        <span class="c1">#   (M) Event Type ID</span>
        <span class="c1">#   (U) Event Information</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">N_EVENT_REPORT</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPClassUID</span> <span class="o">=</span> <span class="n">class_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AffectedSOPInstanceUID</span> <span class="o">=</span> <span class="n">instance_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">EventTypeID</span> <span class="o">=</span> <span class="n">event_type</span>

        <span class="c1"># Encode the `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># *Event Information* is optional</span>
        <span class="k">if</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                                <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">req</span><span class="o">.</span><span class="n">EventInformation</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unable to encode the supplied &#39;Event Information&#39; dataset&quot;</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Send N-EVENT-REPORT request to the peer via DIMSE and wait for</span>
        <span class="c1"># the response primitive</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Event Report Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="c1"># Warning and Success statuses will return a dataset</span>
        <span class="c1">#   we check against None as 0x0000 is a possible status</span>
        <span class="n">event_reply</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_WARNING</span><span class="p">,</span> <span class="n">STATUS_SUCCESS</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">event_reply</span>

            <span class="n">bytestream</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">EventReply</span>
            <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">and</span> <span class="n">bytestream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="c1"># Attempt to decode the response&#39;s dataset</span>
                <span class="c1"># pylint: disable=broad-except</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">event_reply</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">bytestream</span><span class="p">,</span>
                                         <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                         <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to decode the received &#39;Event Reply&#39; dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="c1"># Failure: Processing failure</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0x0110</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">event_reply</span></div>

<div class="viewcode-block" id="Association.send_n_get"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_n_get">[docs]</a>    <span class="k">def</span> <span class="nf">send_n_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier_list</span><span class="p">,</span> <span class="n">class_uid</span><span class="p">,</span> <span class="n">instance_uid</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an N-GET request message to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        identifier_list : list of pydicom.tag.Tag</span>
<span class="sd">            A list of DICOM Data Element tags to be sent for the request&#39;s</span>
<span class="sd">            (0000,1005) *Attribute Identifier List* parameter. Should either be</span>
<span class="sd">            a list of pydicom ``Tag`` objects or a list of values that is</span>
<span class="sd">            acceptable for creating pydicom ``Tag`` objects.</span>
<span class="sd">        class_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,0003) *Requested SOP</span>
<span class="sd">            Class UID* parameter.</span>
<span class="sd">        instance_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,1001) *Requested SOP</span>
<span class="sd">            Instance UID* parameter.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The request&#39;s *Message ID* parameter value, must be between 0 and</span>
<span class="sd">            65535, inclusive, (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then returns a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            *General N-GET* (DICOM Standard Part 7, Section 10.1.2 and Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Successful operation</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0x0107`` - Attribute list error</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0110`` - Processing failure</span>
<span class="sd">              | ``0x0112`` - No such SOP Instance</span>
<span class="sd">              | ``0x0117`` - Invalid object instance</span>
<span class="sd">              | ``0x0118`` - No such SOP Class</span>
<span class="sd">              | ``0x0119`` - Class-Instance conflict</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>
<span class="sd">              | ``0x0213`` - Resource limitation</span>

<span class="sd">            *Modality Performed Procedure Step Management Service* and *Media</span>
<span class="sd">            Creation Management Service* specific</span>
<span class="sd">            (DICOM Standard Part 4, Annex F.8.2.1.4 and Annex S.3.2.4.4):</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0x0001`` - Requested optional Attributes are not supported</span>

<span class="sd">            *Unified Procedure Step Service* specific</span>
<span class="sd">            (DICOM Standard Part 4, Annex CC.2.7.4):</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0x0001`` - Requested optional Attributes are not supported</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC307`` - Specified SOP Instance UID doesn&#39;t exist or is not</span>
<span class="sd">                a UPS Instance managed by this SCP</span>

<span class="sd">            *RT Machine Verification Service* specific</span>
<span class="sd">            (DICOM Standard Part 4, Annex DD.3.2.2.3):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC112`` - Applicable Machine Verification Instance not found</span>

<span class="sd">        attribute_list : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Success&#39; then a ``Dataset`` containing</span>
<span class="sd">            attributes corresponding to those supplied in the *Attribute</span>
<span class="sd">            Identifier List*, otherwise returns ``None``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.N_GET</span>
<span class="sd">        service_class.DisplaySystemManagementServiceClass</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standart Part 4, `Annex F &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_F&gt;`_</span>
<span class="sd">        * DICOM Standart Part 4, `Annex H &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_H&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex S &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_S&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex CC &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_CC&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex DD &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_DD&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex EE &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_EE&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `10.1.2 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.1.2&gt;`_,</span>
<span class="sd">          `10.3.2 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.3.2&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send an N-GET without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be established prior &quot;</span>
                <span class="s2">&quot;to sending an N-GET request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">class_uid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Build N-GET request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Requested SOP Class UID</span>
        <span class="c1">#   (M) Requested SOP Instance UID</span>
        <span class="c1">#   (U) Attribute Identifier List</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">N_GET</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPClassUID</span> <span class="o">=</span> <span class="n">class_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPInstanceUID</span> <span class="o">=</span> <span class="n">instance_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">AttributeIdentifierList</span> <span class="o">=</span> <span class="n">identifier_list</span>

        <span class="c1"># Send N-GET request to the peer via DIMSE and wait for the response</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Get Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="c1"># Warning and Success statuses will return a dataset</span>
        <span class="c1">#   we check against None as 0x0000 is a possible status</span>
        <span class="n">attribute_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_WARNING</span><span class="p">,</span> <span class="n">STATUS_SUCCESS</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">attribute_list</span>

            <span class="n">bytestream</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">AttributeList</span>
            <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">and</span> <span class="n">bytestream</span><span class="o">.</span><span class="n">getvalue</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="c1"># Attempt to decode the response&#39;s dataset</span>
                <span class="c1"># pylint: disable=broad-except</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attribute_list</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">bytestream</span><span class="p">,</span>
                                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to decode the received &#39;Attribute List&#39; &quot;</span>
                        <span class="s2">&quot;dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="c1"># Failure: Processing failure</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0x0110</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">attribute_list</span></div>

<div class="viewcode-block" id="Association.send_n_set"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.Association.html#pynetdicom.association.Association.send_n_set">[docs]</a>    <span class="k">def</span> <span class="nf">send_n_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">class_uid</span><span class="p">,</span> <span class="n">instance_uid</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send an N-SET request message to the peer AE.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : pydicom.dataset.Dataset</span>
<span class="sd">            The dataset that will be sent as the *Modification List* parameter</span>
<span class="sd">            in the N-SET request.</span>
<span class="sd">        class_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,0003) *Requested SOP</span>
<span class="sd">            Class UID* parameter.</span>
<span class="sd">        instance_uid : pydicom.uid.UID</span>
<span class="sd">            The UID to be sent for the request&#39;s (0000,1001) *Requested SOP</span>
<span class="sd">            Instance UID* parameter.</span>
<span class="sd">        msg_id : int, optional</span>
<span class="sd">            The request&#39;s *Message ID* parameter value, must be between 0 and</span>
<span class="sd">            65535, inclusive, (default 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : pydicom.dataset.Dataset</span>
<span class="sd">            If the peer timed out, aborted or sent an invalid response then</span>
<span class="sd">            returns an empty ``Dataset``. If a response was received from the</span>
<span class="sd">            peer then returns a ``Dataset`` containing at least a (0000,0900)</span>
<span class="sd">            *Status* element, and depending on the returned value, may</span>
<span class="sd">            optionally contain additional elements (see the DICOM Standard,</span>
<span class="sd">            Part 7, Section 9.1.2.1.5 and Annex C).</span>

<span class="sd">            *General N-SET* (DICOM Standard Part 7, Section 10.1.3 and Annex C)</span>

<span class="sd">            Success</span>
<span class="sd">              | ``0x0000`` - Successful operation</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0x0107`` - Attribute list error</span>
<span class="sd">              | ``0x0116`` - Attribute value out of range</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0x0105`` - No such attribute</span>
<span class="sd">              | ``0x0106`` - Invalid attribute value</span>
<span class="sd">              | ``0x0110`` - Processing failure</span>
<span class="sd">              | ``0x0112`` - No such SOP Instance</span>
<span class="sd">              | ``0x0117`` - Invalid object instance</span>
<span class="sd">              | ``0x0118`` - No such SOP Class</span>
<span class="sd">              | ``0x0119`` - Class-Instance conflict</span>
<span class="sd">              | ``0x0121`` - Missing attribute value</span>
<span class="sd">              | ``0x0122`` - SOP class not supported</span>
<span class="sd">              | ``0x0124`` - Not authorised</span>
<span class="sd">              | ``0x0210`` - Duplicate invocation</span>
<span class="sd">              | ``0x0211`` - Unrecognised operation</span>
<span class="sd">              | ``0x0212`` - Mistyped argument</span>
<span class="sd">              | ``0x0213`` - Resource limitation</span>

<span class="sd">            *Print Management Service* specific (DICOM</span>
<span class="sd">            Standard Part 4, Annex H.4.1.2.1.2, H.4.2.2.1.2, H.4.3.1.2.1.2 and</span>
<span class="sd">            H.4.3.2.2.1.2):</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0xB600`` - Memory allocation not supported</span>
<span class="sd">              | ``0xB604`` - Image size larger than image box size, the image</span>
<span class="sd">                has been demagnified</span>
<span class="sd">              | ``0xB605`` - Requested Min Density or Max Density outside of</span>
<span class="sd">                printer&#39;s operating range. The printer will use its respective</span>
<span class="sd">                minimum or maximum density value instead</span>
<span class="sd">              | ``0xB609`` - Image size is larger than the Image Box. The Image</span>
<span class="sd">                has been cropped to fit</span>
<span class="sd">              | ``0xB60A`` - Image size or Combined Print Image size is larger</span>
<span class="sd">                than the Image Box size. The Image or Combined Print Image has</span>
<span class="sd">                been decimated to fit</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC603`` - Image size is larger than image box size</span>
<span class="sd">              | ``0xC605`` - Insufficient memory in printer to store the image</span>
<span class="sd">              | ``0xC613`` - Combined Print Image size is larger than the Image</span>
<span class="sd">                Box size</span>
<span class="sd">              | ``0xC616`` - There is an existing Film Box that has not been</span>
<span class="sd">                printed and N-ACTION at the Film Session level is not</span>
<span class="sd">                supported. A new Film Box will not be created when a previous</span>
<span class="sd">                Film Box has not been printed</span>

<span class="sd">            *Unified Procedure Step Service* specific (DICOM Standard Part 4,</span>
<span class="sd">            Annex CC.2.6.4):</span>

<span class="sd">            Warning</span>
<span class="sd">              | ``0x0001`` - Requested optional attributes are not supported</span>
<span class="sd">              | ``0xB305`` - Coerced invalid values to valid values</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC300`` - The UPS may no longer be updated</span>
<span class="sd">              | ``0xC301`` - The correct Transaction UID was not provided</span>
<span class="sd">              | ``0xC307`` - Specified SOP Instance UID does not exist or is</span>
<span class="sd">                not a UPS Instance managed by this SCP</span>
<span class="sd">              | ``0xC310`` - The UPS is not in the &#39;IN PROGRESS&#39; state</span>

<span class="sd">            *RT Machine Verification Service* specific (DICOM Standard Part 4,</span>
<span class="sd">            Annex DD.3.2.1.2):</span>

<span class="sd">            Failure</span>
<span class="sd">              | ``0xC224`` - Reference Beam Number not found within the</span>
<span class="sd">                referenced Fraction Group</span>
<span class="sd">              | ``0xC225`` - Referenced device or accessory not supported</span>
<span class="sd">              | ``0xC226`` - Referenced device or accessory not found with the</span>
<span class="sd">                referenced beam</span>

<span class="sd">        attribute_list : pydicom.dataset.Dataset or None</span>
<span class="sd">            If the status category is &#39;Success&#39; then a ``Dataset`` containing</span>
<span class="sd">            attributes corresponding to those supplied in the *Attribute List*,</span>
<span class="sd">            otherwise returns ``None``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimse_primitives.N_SET</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        * DICOM Standart Part 4, `Annex F &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_F&gt;`_</span>
<span class="sd">        * DICOM Standart Part 4, `Annex H &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_H&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex CC &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_CC&gt;`_</span>
<span class="sd">        * DICOM Standard Part 4, `Annex DD &lt;http://dicom.nema.org/medical/dicom/current/output/html/part04.html#chapter_DD&gt;`_</span>
<span class="sd">        * DICOM Standard Part 7, Sections</span>
<span class="sd">          `10.1.3 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.1.3&gt;`_,</span>
<span class="sd">          `10.3.3 &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#sect_10.3.3&gt;`_</span>
<span class="sd">          and `Annex C &lt;http://dicom.nema.org/medical/dicom/current/output/html/part07.html#chapter_C&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t send an N-SET without an Association</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The association with a peer SCP must be established prior &quot;</span>
                <span class="s2">&quot;to sending an N-SET request.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the Presentation Context we are operating under</span>
        <span class="c1">#   and hence the transfer syntax to use for encoding `dataset`</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_context</span><span class="p">(</span><span class="n">class_uid</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scu&#39;</span><span class="p">)</span>
        <span class="n">transfer_syntax</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">transfer_syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Build N-SET request primitive</span>
        <span class="c1">#   (M) Message ID</span>
        <span class="c1">#   (M) Requested SOP Class UID</span>
        <span class="c1">#   (M) Requested SOP Instance UID</span>
        <span class="c1">#   (M) Modification List</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">N_SET</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">MessageID</span> <span class="o">=</span> <span class="n">msg_id</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPClassUID</span> <span class="o">=</span> <span class="n">class_uid</span>
        <span class="n">req</span><span class="o">.</span><span class="n">RequestedSOPInstanceUID</span> <span class="o">=</span> <span class="n">instance_uid</span>

        <span class="c1"># Encode the `dataset` using the agreed transfer syntax</span>
        <span class="c1">#   Will return None if failed to encode</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">ModificationList</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to encode the supplied &#39;Modification List&#39; dataset&quot;</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Send N-SET request to the peer via DIMSE and wait for the response</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending Set Request: MsgID </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">))</span>

        <span class="c1"># Pause the reactor to prevent a race condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">send_msg</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">context_id</span><span class="p">)</span>
        <span class="n">cx_id</span><span class="p">,</span> <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimse</span><span class="o">.</span><span class="n">get_msg</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Unpause the reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor_checkpoint</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># If `rsp` is None then the DIMSE timeout expired so abort</span>
        <span class="k">if</span> <span class="n">rsp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_established</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Connection closed or timed-out&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(),</span> <span class="kc">None</span>

        <span class="c1"># Determine validity of the response and get the status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_received_status</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>

        <span class="c1"># Warning and Success statuses will return a dataset</span>
        <span class="c1">#   we check against None as 0x0000 is a possible status</span>
        <span class="n">attribute_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">code_to_category</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STATUS_WARNING</span><span class="p">,</span> <span class="n">STATUS_SUCCESS</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">attribute_list</span>

            <span class="n">bytestream</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">AttributeList</span>
            <span class="k">if</span> <span class="n">bytestream</span> <span class="ow">and</span> <span class="n">bytestream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="c1"># Attempt to decode the response&#39;s dataset</span>
                <span class="c1"># pylint: disable=broad-except</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attribute_list</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">AttributeList</span><span class="p">,</span>
                                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_implicit_VR</span><span class="p">,</span>
                                            <span class="n">transfer_syntax</span><span class="o">.</span><span class="n">is_little_endian</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to decode the received &#39;Attribute List&#39; &quot;</span>
                        <span class="s2">&quot;dataset&quot;</span>
                    <span class="p">)</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="c1"># Failure: Processing failure</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">Status</span> <span class="o">=</span> <span class="mh">0x0110</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">attribute_list</span></div></div>


<div class="viewcode-block" id="ServiceUser"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.ServiceUser.html#pynetdicom.association.ServiceUser">[docs]</a><span class="k">class</span> <span class="nc">ServiceUser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convenience class for the ``Association`` service user.</span>

<span class="sd">    An ``Association`` object has two ``ServiceUser`` attributes, one</span>
<span class="sd">    representing the association *Requestor* and the other the association</span>
<span class="sd">    *Acceptor*. Once both have been defined sufficiently to be considered</span>
<span class="sd">    valid then association negotiation can begin. The *Requestor*</span>
<span class="sd">    ``ServiceUser`` requires (at a minimum) the following in order to be valid:</span>

<span class="sd">    * For association as requestor:</span>

<span class="sd">        * AE title (ae_title)</span>
<span class="sd">        * Address and port number (address and port)</span>
<span class="sd">        * Maximum PDU length (maximum_length)</span>
<span class="sd">        * Implementation class UID (implementation_class_uid)</span>
<span class="sd">        * At least one presentation context (requested_contexts)</span>
<span class="sd">    * For association as acceptor:</span>

<span class="sd">        * AE title</span>
<span class="sd">        * Address and port number</span>

<span class="sd">    The *Acceptor* ``ServiceUser`` requires (at a minimum) the following in</span>
<span class="sd">    order to be valid:</span>

<span class="sd">    * For association as requestor:</span>

<span class="sd">        * Address and port number</span>
<span class="sd">    * For association as acceptor:</span>

<span class="sd">        * AE title</span>
<span class="sd">        * Address and port number</span>
<span class="sd">        * Maximum PDU length</span>
<span class="sd">        * Implementation class UID</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    address : str</span>
<span class="sd">        The TCP/IP address of the AE.</span>
<span class="sd">    ae_title : bytes</span>
<span class="sd">        The AE&#39;s AE title.</span>
<span class="sd">    port : int</span>
<span class="sd">        The port number of the AE.</span>
<span class="sd">    primitive : None or pdu_primitives.A_ASSOCIATE</span>
<span class="sd">        The A-ASSOCIATE primitive (request if mode is &#39;requestor&#39;,</span>
<span class="sd">        accept/reject if mode is &#39;acceptor&#39;) sent or received by the AE</span>
<span class="sd">        during association negotiation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ServiceUser.__init__"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.ServiceUser.html#pynetdicom.association.ServiceUser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ServiceUser.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        assoc : association.Association</span>
<span class="sd">            The parent Association.</span>
<span class="sd">        mode : str</span>
<span class="sd">            The operation mode of the AE represented by the ServiceUser, either</span>
<span class="sd">            &#39;requestor&#39; or &#39;acceptor&#39;. This is not necessarily the same as the</span>
<span class="sd">            association&#39;s mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MODE_REQUESTOR</span><span class="p">,</span> <span class="n">MODE_ACCEPTOR</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;mode&#39; must be either &#39;requestor&#39; or &#39;acceptor&#39;&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assoc</span> <span class="o">=</span> <span class="n">assoc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primitive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ae_title</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># If Requestor this is the requested contexts, otherwise this is</span>
        <span class="c1">#   the supported contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># User Information items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Must always be set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_length</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_LENGTH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">implementation_class_uid</span> <span class="o">=</span> <span class="n">assoc</span><span class="o">.</span><span class="n">ae</span><span class="o">.</span><span class="n">implementation_class_uid</span>

        <span class="c1"># The are the proposed extended negotiation items,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_negotiation_items</span><span class="p">()</span>

        <span class="c1"># If Acceptor then this the accepted SOP Class Common Extended</span>
        <span class="c1">#   negotiation items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_common_ext</span> <span class="o">=</span> <span class="p">{}</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">accepted_common_extended</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dict of the accepted SOP Class Common Extended Negotiation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of 2-tuple</span>
<span class="sd">            The {SOP Class UID : (Service Class UID, Related General SOP Class</span>
<span class="sd">            Identification)} for the accepted SOP Class Common Extended</span>
<span class="sd">            negotiation items.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If called when the requestor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;accepted_common_extended&#39; is only available for the &quot;</span>
                <span class="s2">&quot;&#39;acceptor&#39;&quot;</span>
            <span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_ext</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">item</span><span class="o">.</span><span class="n">service_class_uid</span><span class="p">,</span>
                <span class="n">item</span><span class="o">.</span><span class="n">related_general_sop_class_identification</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="ServiceUser.add_negotiation_item"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.ServiceUser.html#pynetdicom.association.ServiceUser.add_negotiation_item">[docs]</a>    <span class="k">def</span> <span class="nf">add_negotiation_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an extended negotiation item to the user information.</span>

<span class="sd">        Items can only be added prior to starting the association negotiation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : pdu_primitives.ServiceParameter</span>
<span class="sd">            An extended negotiation item, one of</span>
<span class="sd">            SCP_SCU_RoleSelectionNegotiation, UserIdentityNegotiation,</span>
<span class="sd">            AsynchronousOperationsWindowNegotiation,</span>
<span class="sd">            SOPClassExtendedNegotiation or SOPClassCommonExtendedNegotiation.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If attempting to add an item after association negotiation has</span>
<span class="sd">            started.</span>
<span class="sd">        TypeError</span>
<span class="sd">            If `item` it not an extended negotiation item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t add extended negotiation items after negotiation &quot;</span>
                <span class="s2">&quot;has started&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;item&#39; is not a valid extended negotiation item&quot;</span>
            <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">asynchronous_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Asynchronous Operations Window operations numbers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        2-tuple of int</span>
<span class="sd">            The (Maximum Number of Operations Invoked, Maximum Number of</span>
<span class="sd">            Operations Performed) or (1, 1) if no Asynchronous Operations</span>
<span class="sd">            Window Negotiation item is in the extended negotiation items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">AsynchronousOperationsWindowNegotiation</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">maximum_number_operations_invoked</span><span class="p">,</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">maximum_number_operations_performed</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">AsynchronousOperationsWindowNegotiation</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">maximum_number_operations_invoked</span><span class="p">,</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">maximum_number_operations_performed</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extended_negotiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of Extended Negotiation items.</span>

<span class="sd">        Extended Negotiation items are:</span>

<span class="sd">        * SCP/SCU Role Selection Negotiation (0 or more)</span>
<span class="sd">        * Asynchronous Operations Window Negotiation (0 or 1)</span>
<span class="sd">        * SOP Class Extended Negotiation (0 or more)</span>
<span class="sd">        * SOP Class Common Extended Negotiation (0 or more)</span>
<span class="sd">        * User Identity Negotiation (0 or 1)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            If `mode` is &#39;requestor&#39; then returns a list of the proposed</span>
<span class="sd">            extended negotiation items, otherwise returns a list of the</span>
<span class="sd">            extended negotiation item responses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">negotiation_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">negotiation_type</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">items</span>

        <span class="c1"># pylint: disable=unidiomatic-typecheck</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">items</span>

<div class="viewcode-block" id="ServiceUser.get_contexts"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.ServiceUser.html#pynetdicom.association.ServiceUser.get_contexts">[docs]</a>    <span class="k">def</span> <span class="nf">get_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cx_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of PresentationContext corresponding to `cx_type`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cx_type : str</span>
<span class="sd">            The type of contexts to return, if `mode` is &#39;requestor&#39;:</span>

<span class="sd">            - If the association has not yet been negotiated then &#39;requested&#39;.</span>
<span class="sd">            - If the association has been negotiated then &#39;requested&#39; or</span>
<span class="sd">              &#39;pcdl&#39;.</span>

<span class="sd">            If `mode` is &#39;acceptor&#39;:</span>

<span class="sd">            - If the association has not yet been negotiated then &#39;supported&#39;.</span>
<span class="sd">            - If the association has been negotiated then &#39;supported&#39; or</span>
<span class="sd">              &#39;pcdrl&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of presentation.PresentationContext</span>
<span class="sd">            A list of presentations contexts, if `cx_type` is &#39;requested&#39; then</span>
<span class="sd">            the requested presentation contexts, if &#39;pcdl&#39; then the</span>
<span class="sd">            presentation contexts from the A-ASSOCIATE (request) primitive&#39;s</span>
<span class="sd">            Presentation Context Definition List parameter. If &#39;supported&#39; then</span>
<span class="sd">            the supported presentation contexts, if &#39;pcdrl&#39; then the</span>
<span class="sd">            presentation contexts from the A-ASSOCIATE (accept) primitive&#39;s</span>
<span class="sd">            Presentation Context Definition Results List parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contexts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;requested&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">,</span> <span class="s1">&#39;supported&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="n">contexts</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;pcdl&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">presentation_context_definition_list</span><span class="p">,</span>
                <span class="s1">&#39;pcdrl&#39;</span> <span class="p">:</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">presentation_context_definition_results_list</span>
                <span class="p">)</span>
            <span class="p">})</span>

        <span class="n">possible</span> <span class="o">=</span> <span class="p">{</span>
            <span class="kc">True</span> <span class="p">:</span> <span class="p">{</span>
                <span class="kc">True</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;requested&#39;</span><span class="p">],</span>
                <span class="kc">False</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;supported&#39;</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="kc">False</span> <span class="p">:</span> <span class="p">{</span>
                <span class="kc">True</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;requested&#39;</span><span class="p">,</span> <span class="s1">&#39;pcdl&#39;</span><span class="p">],</span>
                <span class="kc">False</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;supported&#39;</span><span class="p">,</span> <span class="s1">&#39;pcdrl&#39;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">available</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">is_requestor</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cx_type</span> <span class="ow">in</span> <span class="n">available</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">contexts</span><span class="p">[</span><span class="n">cx_type</span><span class="p">]</span>

        <span class="n">available</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">available</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid &#39;cx_type&#39;, must be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">))</span>
        <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implementation_class_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Implementation Class UID as a pydicom UID.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pydicom.uid.UID or None</span>
<span class="sd">            Returns the Implementation Class UID if the requestor or if</span>
<span class="sd">            the acceptor and they have accepted the negotiation. Returns None</span>
<span class="sd">            if the acceptor and they have rejected the negotiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImplementationClassUIDNotification</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">implementation_class_uid</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImplementationClassUIDNotification</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">implementation_class_uid</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@implementation_class_uid</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">implementation_class_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the Implementation Class UID (only prior to association).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str or pydicom.uid.UID</span>
<span class="sd">            The Implementation Class UID value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set the Implementation Class UID after negotiation &quot;</span>
                <span class="s2">&quot;has started&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImplementationClassUIDNotification</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">implementation_class_uid</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">ImplementationClassUIDNotification</span><span class="p">()</span>
            <span class="n">item</span><span class="o">.</span><span class="n">implementation_class_uid</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implementation_version_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Implementation Version Name as str (if available).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or None</span>
<span class="sd">            Returns None if the acceptor and they have rejected the</span>
<span class="sd">            negotiation or if no Implementation Version Name Notification item</span>
<span class="sd">            has been included in the association negotiation. Otherwise returns</span>
<span class="sd">            the Implementation Version Name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImplementationVersionNameNotification</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">implementation_version_name</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImplementationVersionNameNotification</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">implementation_version_name</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@implementation_version_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">implementation_version_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the Implementation Version Name (only prior to association).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str</span>
<span class="sd">            The Implementation Version Name value to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set the Implementation Version Name after negotiation &quot;</span>
                <span class="s2">&quot;has started&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImplementationVersionNameNotification</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">implementation_version_name</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">ImplementationVersionNameNotification</span><span class="p">()</span>
            <span class="n">item</span><span class="o">.</span><span class="n">implementation_version_name</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dict with information about the ServiceUser.&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ae_title&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae_title</span><span class="p">,</span>
            <span class="s1">&#39;address&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pdv_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_length</span>

        <span class="k">return</span> <span class="n">info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_acceptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the ServiceUser is the association acceptor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_ACCEPTOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_requestor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the ServiceUser is the association requestor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_REQUESTOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maximum_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the maximum PDV size as int.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int or None</span>
<span class="sd">            Returns the Maximum Received Length if the requestor or if</span>
<span class="sd">            the acceptor and they have accepted the negotiation. Returns None</span>
<span class="sd">            if the acceptor and they have rejected the negotiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MaximumLengthNotification</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">maximum_length_received</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MaximumLengthNotification</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">maximum_length_received</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@maximum_length</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">maximum_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the Maximum PDU Length (only prior to association).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int or None</span>
<span class="sd">            The value to use in the Maximum Length Negotiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set the Maximum Length after negotiation has started&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MaximumLengthNotification</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">maximum_length_received</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">MaximumLengthNotification</span><span class="p">()</span>
            <span class="n">item</span><span class="o">.</span><span class="n">maximum_length_received</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the mode as str, either &#39;requestor&#39; or &#39;acceptor&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">requested_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the requestor&#39;s requested presentation contexts.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contexts</span><span class="p">(</span><span class="s1">&#39;requested&#39;</span><span class="p">)</span>

    <span class="nd">@requested_contexts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">requested_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the requested presentation contexts.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : list of presentation.PresentationContext</span>
<span class="sd">            A list of the presentation contexts to propose when acting as the</span>
<span class="sd">            association requestor.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If attempting to set the contexts after negotiation has begun.</span>
<span class="sd">        AttributeError</span>
<span class="sd">            If attempting to set the contexts as the association acceptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set the requested presentation contexts after &quot;</span>
                <span class="s2">&quot;negotiation has started&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_requestor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;requested_contexts&#39; can only be set for the association &quot;</span>
                <span class="s2">&quot;requestor&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ServiceUser.remove_negotiation_item"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.ServiceUser.html#pynetdicom.association.ServiceUser.remove_negotiation_item">[docs]</a>    <span class="k">def</span> <span class="nf">remove_negotiation_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove an extended negotiation item from the user information.</span>

<span class="sd">        Items can only be removed prior to starting the association</span>
<span class="sd">        negotiation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : pdu_primitives.ServiceParameter</span>
<span class="sd">            An extended negotiation item, one of</span>
<span class="sd">            SCP_SCU_RoleSelectionNegotiation, UserIdentityNegotiation,</span>
<span class="sd">            AsynchronousOperationsWindowNegotiation,</span>
<span class="sd">            SOPClassExtendedNegotiation or SOPClassCommonExtendedNegotiation.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If attempting to remove an item after association negotiation has</span>
<span class="sd">            started.</span>
<span class="sd">        TypeError</span>
<span class="sd">            If `item` it not an extended negotiation item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t remove extended negotiation items after negotiation &quot;</span>
                <span class="s2">&quot;has started&quot;</span>
            <span class="p">)</span>

        <span class="c1"># pylint: disable=unidiomatic-typecheck</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">:</span>
            <span class="c1"># Do nothing if item not in _ext_neg</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;item&#39; is not a valid extended negotiation item&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ServiceUser.reset_negotiation_items"><a class="viewcode-back" href="../../reference/generated/pynetdicom.association.ServiceUser.html#pynetdicom.association.ServiceUser.reset_negotiation_items">[docs]</a>    <span class="k">def</span> <span class="nf">reset_negotiation_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all extended negotiation items.</span>

<span class="sd">        Items can only be removed prior to starting the association</span>
<span class="sd">        negotiation.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If attempting to clear the extended negotiation items after</span>
<span class="sd">            association negotiation has started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t reset the extended negotiation items after negotiation &quot;</span>
                <span class="s2">&quot;has started&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">SCP_SCU_RoleSelectionNegotiation</span> <span class="p">:</span> <span class="p">[],</span>
            <span class="n">AsynchronousOperationsWindowNegotiation</span> <span class="p">:</span> <span class="p">[],</span>
            <span class="n">UserIdentityNegotiation</span> <span class="p">:</span> <span class="p">[],</span>
            <span class="n">SOPClassExtendedNegotiation</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_requestor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">SOPClassCommonExtendedNegotiation</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">role_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return any SCP/SCU Role Selection items as a dict.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The SCP/SCU Role Selection items as {SOP Class UID :</span>
<span class="sd">            SCP_SCU_RoleSelectionNegotiation}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">SCP_SCU_RoleSelectionNegotiation</span><span class="p">]:</span>
                <span class="n">roles</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

            <span class="k">return</span> <span class="n">roles</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">SCP_SCU_RoleSelectionNegotiation</span><span class="p">):</span>
                <span class="n">roles</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

        <span class="k">return</span> <span class="n">roles</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sop_class_common_extended</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return any SOP Class Common Extended items as dict.</span>

<span class="sd">        If the ServiceUser is the association acceptor then no SOP Class</span>
<span class="sd">        Common Extended items will be present in the User Information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The SOP Class Common Extended items as {SOP Class UID : item}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">sop_classes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">SOPClassCommonExtendedNegotiation</span><span class="p">]:</span>
                <span class="n">sop_classes</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

            <span class="k">return</span> <span class="n">sop_classes</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">SOPClassCommonExtendedNegotiation</span><span class="p">):</span>
                <span class="n">sop_classes</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

        <span class="k">return</span> <span class="n">sop_classes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sop_class_extended</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return any SOP Class Extended items as dict.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The SOP Class Extended items as {SOP Class UID : Service Class</span>
<span class="sd">            Application Information}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sop_classes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">SOPClassExtendedNegotiation</span><span class="p">]:</span>
                <span class="n">sop_classes</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">service_class_application_information</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">sop_classes</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">SOPClassExtendedNegotiation</span><span class="p">):</span>
                <span class="n">sop_classes</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sop_class_uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">service_class_application_information</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">sop_classes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supported_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of supported presentation contexts.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of presentation.PresentationContext</span>
<span class="sd">            The supported presentation contexts when acting as an acceptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contexts</span><span class="p">(</span><span class="s1">&#39;supported&#39;</span><span class="p">)</span>

    <span class="nd">@supported_contexts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">supported_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the supported presentation contexts.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : list of presentation.PresentationContext</span>
<span class="sd">            A list of the presentation contexts to support when acting as the</span>
<span class="sd">            association acceptor.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If attempting to set the contexts after negotiation has begun.</span>
<span class="sd">        AttributeError</span>
<span class="sd">            If attempting to set the contexts as the association requestor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set the supported presentation contexts after &quot;</span>
                <span class="s2">&quot;negotiation has started&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;supported_contexts&#39; can only be set for the association &quot;</span>
                <span class="s2">&quot;acceptor&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the User Identity Negotiation Item (if available).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdu_primitives.UserIdentityNegotiation or None</span>
<span class="sd">            Returns the User Identity item if one is available, otherwise</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_neg</span><span class="p">[</span><span class="n">UserIdentityNegotiation</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_information</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">UserIdentityNegotiation</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">item</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_information</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the User Information items.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeable</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">user_information</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_info</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">extended_negotiation</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">writeable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the current object can be changed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primitive</span> <span class="ow">is</span> <span class="kc">None</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-19, pynetdicom contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>